<include file="../Public/header_main" />
<load file="__PUBLIC__/Css/Ilc/resource_index.css"/>
<script type="text/javascript">
$(function(){

    var listObj = {"data_check": "2%","data_id": "8%" ,"data_name": "10%","data_type": "20%","data_grade": "10%","data_sem": "10%","data_version": "10%","data_subject": "6%","data_status": "8%","data_hand": "4%","data_edit": "4%","data_add": "4%","data_child": "8%"};
    setWidth(listObj);

    // 隐藏专业ID
    var majorFlag= '{$prevMajor}';
    if (majorFlag == '0') {
        $('select[name=c_major]').hide();
    }

    // 通过学校获取学段
    $('select[name=s_id]').change(function() {
        $('select[name=c_type]').html('<option value="0">请选择</option>');
        $('select[name=c_major]').hide();
        $('select[name=c_grade]').html('<option value="0">请选择</option>');
        $('select[name=c_id]').html('<option value="0">请选择</option>');

        // 获取学段
        var sType = $('select[name=s_id] option:selected').attr('attr');

        var str = '<option value="0">请选择</option>';
        if (sType != '') {
            var typeArr = sType.split(',');

            for (var p in typeArr) {

                str += '<option value="'+typeArr[p]+'">'+$('.schoolType span').eq(typeArr[p] - 1).html()+'</option>';
            }
        }
        $('select[name=c_type]').html(str);
    })

    // 通过学段获取年级
    $('select[name=c_type]').change(function() {
        $(this).nextAll().children('option').removeAttr('selected');
        if ($(this).val() == 4) {
            $('select[name=c_major]').show();
            listGradeOption($('select[name=s_id]').val(), $(this).val(), 'c_major');
        } else {
            $('select[name=c_major]').hide();
            listGradeOption($('select[name=s_id]').val(), $(this).val(), 'c_grade');
        }
    })

    // 通过专业获取年级
    $(document).on('change', 'select[name=c_major]', function () {
        listGradeOption($('select[name=s_id]').val(), $(this).val(), 'c_grade', 0, 'major');
    })

    // 通过年级获取班级
    $('select[name=c_grade]').change(function() {
        $(this).nextAll().children('option').removeAttr('selected');
        var ma_id = 0;
        if ($('select[name=c_major]').css('display') != 'none') {
            ma_id = $('select[name=c_major]').val();
        }
        listClass($('select[name=s_id]').val(), $('select[name=c_type]').val(), $(this).val(), 'c_id', 0, ma_id);
    })

})

</script>

    <form name="form" method="post" action="__URL__">
        <div class="model_search">
            <a>姓名：</a>
            <input TYPE="text" title="名称查询" name="a_nickname" >
            <a class="search">搜索</a>
            <div class="clear"></div>
            <select name="s_id" >
                <option attr="" value="0">请选择</option>
                <volist name="school" id="school">
                    <option value="{$school.s_id}" attr="{$school.s_type}"  <eq name="prevsId" value="$school.s_id">selected</eq> >{$school.s_name}</option>
                </volist>
            </select>
            <select name="c_type">
                <option value="0">请选择</option>
                <foreach name="csType" item="type" key="typekey">
                    <option value="{$typekey}" <eq name="prevcType" value="$typekey">selected</eq> >{$type}</option>
                </foreach>
            </select>
            <select name="c_major" >
                <option value="0">请选择</option>
                <volist name="major" id="vo">
                <option value="{$vo.ma_id}" <if condition="$vo.ma_id eq $prevMajor ">selected</if> >{$vo.ma_title}</option>
                </volist>
            </select>
            <select name="c_grade" >
                <option value="0">请选择</option>
                <foreach name="grade" item="gradename" key="gradekey">
                    <option value="{$gradekey}" <eq name="prevcGrade" value="$gradekey">selected</eq> >{$gradename}</option>
                </foreach>
            </select>
            <select name="c_id"  >
                <option value="0" >请选择</option>
                <foreach name="class" item="classname" key="classkey">
                    <option value="{$classkey}" <eq name="prevcId" value="$classkey">selected</eq> >{$classname}</option>
                </foreach>
            </select>
        </div>
    </form>
    <div class="tools fl">
        <a class="add">
            <i></i>
            新增
        </a>
        <a class="edit">
            <i></i>
            编辑
        </a>
        <a class="forbidden">
            <i></i>
            禁用
        </a>
        <a class="resume">
            <i></i>
            启用
        </a>
    </div>
    <div id="system_list">
        <div>
            <ul class="list_hea">
                <li>
                    <input class="data_check" type="checkbox" name="allcheck" onclick="CheckAll('system_list')"/>
                    <span class="data_id">编号</span>
                    <span class="data_name">学校</span>
                    <span class="data_type">班级</span>
                    <span class="data_grade">用户名</span>
                    <span class="data_sem">姓名</span>
                    <span class="data_version">手机</span>
                    <span class="data_subject">登陆次数</span>
                    <span class="data_status">登陆IP</span>
                    <span class="data_status">状态</span>
                    <span class="data_hand">操作</span>
                </li>
            </ul>
        </div>
        <div>
            <ul class="list_list list_hea" id="list_main">

                <volist name="list" id="list">
                    <li>
                        <input class="data_check" type="checkbox" value="{$list.a_id}" name="key"/>
                        <span class="data_id">{$list.a_id}</span>
                        <span class="data_name">{$list.s_name}</span>
                        <span class="data_type">{$list.c_title}</span>
                        <span class="data_grade">{$list.a_account}</span>
                        <span class="data_sem">{$list.a_nickname}</span>
                        <span class="data_version">{$list.a_tel}</span>
                        <span class="data_subject">{$list.a_login_count}</span>
                        <span class="data_status">{$list.a_last_login_ip}</span>
                        <span class="data_status">{$list.a_status|getStatus}</span>
                        <span class="data_hand"><a href="javascript:edit({$list.a_id})">编辑</a></span>

                    </li>
                </volist>

            </ul>
        </div>
        <div class="page">
            {$page}
        </div>
    </div>

    <div class="schoolType" style="display:none;">
        <volist name="schoolType" id="schoolType">
            <span>{$schoolType}</span>
        </volist>
    </div>
