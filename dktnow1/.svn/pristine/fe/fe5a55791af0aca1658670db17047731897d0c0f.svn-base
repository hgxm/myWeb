//
//  SetView.m
//  ClassRoomTeacher
//
//  Created by apple  on 13-6-3.
//  Copyright (c) 2013年 apple . All rights reserved.
//

#import "SetView.h"

@implementation SetView

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        UIView *blackView = [[UIView alloc]initWithFrame:CGRectMake(0, 0, 1024, 748)];
        blackView.backgroundColor=[UIColor blackColor];
        blackView.alpha=0.3;
        blackView.userInteractionEnabled = YES;
        [self addSubview:blackView];
        [blackView release];
        
        backImage = [[UIImageView alloc] initWithFrame:CGRectMake(1024/2-526/2, 748/2-378/2, 526, 377)];
        backImage.userInteractionEnabled = YES;
        backImage.image = [UIImage imageNamed:@"设置背景.png"];
        [self addSubview:backImage];
        [backImage release];
        
        
        UILabel *lbl1 = [[UILabel alloc]initWithFrame:CGRectMake(25, 10, 120, 40)];
        lbl1.textAlignment = NSTextAlignmentLeft;
        lbl1.text = @"系统设置";
        lbl1.font = [UIFont boldSystemFontOfSize:20];
        lbl1.backgroundColor = [UIColor clearColor];
        lbl1.textColor = [UIColor blackColor];
        [backImage addSubview:lbl1];
        [lbl1 release];
        
        
        UILabel *lbl2 = [[UILabel alloc]initWithFrame:CGRectMake(25, 70, 120, 40)];
        lbl2.textAlignment = NSTextAlignmentLeft;
        lbl2.text = @"服务器地址";
        lbl2.font = [UIFont systemFontOfSize:17];
        lbl2.backgroundColor = [UIColor clearColor];
        lbl2.textColor = [UIColor blackColor];
        [backImage addSubview:lbl2];
        [lbl2 release];
        
        UIImageView *inputView = [[UIImageView alloc]initWithFrame:CGRectMake(25, 110, 474, 52)];
        inputView.image = [UIImage imageNamed:@"设置输入框.png"];
        [backImage addSubview:inputView];
        [inputView release];
        
        
        text1 = [[UITextField alloc]initWithFrame:CGRectMake(35, 120, 474, 52)];
        text1.text=@"";
        text1.delegate=self;
        [backImage addSubview:text1];
        [text1 release];
        
        
        UILabel *lbl3 = [[UILabel alloc]initWithFrame:CGRectMake(25, 162, 120, 40)];
        lbl3.textAlignment = NSTextAlignmentLeft;
        lbl3.text = @"推送服务器地址";
        lbl3.font = [UIFont systemFontOfSize:17];
        lbl3.backgroundColor = [UIColor clearColor];
        lbl3.textColor = [UIColor blackColor];
        [backImage addSubview:lbl3];
        [lbl3 release];
        
        
        UIImageView *inputView2 = [[UIImageView alloc]initWithFrame:CGRectMake(25, 202, 474, 52)];
        inputView2.image = [UIImage imageNamed:@"设置输入框.png"];
        [backImage addSubview:inputView2];
        [inputView2 release];
        
        text2 = [[UITextField alloc]initWithFrame:CGRectMake(35, 212, 474, 52)];
        text2.text=@"";
        text2.delegate=self;
        [backImage addSubview:text2];
        [text2 release];
        
        if ([[NSUserDefaults standardUserDefaults] objectForKey:@"IP"]) {
            
            text1.text=[[NSUserDefaults standardUserDefaults] objectForKey:@"IP"];
        }
        if ([[NSUserDefaults standardUserDefaults] objectForKey:@"IP2"]) {
            
            text2.text=[[NSUserDefaults standardUserDefaults] objectForKey:@"IP2"];
        }
        
        
        for (int i=0; i<2; i++) {
            UIButton *btn = [[UIButton alloc] initWithFrame:CGRectMake(30+i*232, 290, 212, 47)];
            [btn addTarget:self action:@selector(btnActions:) forControlEvents:UIControlEventTouchUpInside];
            [btn setBackgroundImage:[UIImage imageNamed:@"登录按钮.png"] forState:UIControlStateNormal];
            btn.tag=i+10;
            [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
            [backImage addSubview:btn];
            [btn release];
            
            
            switch (i) {
                case 0:
                    [btn setBackgroundImage:[UIImage imageNamed:@"设置取消.png"] forState:UIControlStateNormal];
                    [btn setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];

                    [btn setTitle:@"取消" forState:UIControlStateNormal];

                    break;
                case 1:
                    [btn setBackgroundImage:[UIImage imageNamed:@"设置确定.png"] forState:UIControlStateNormal];
                    [btn setTitle:@"确定" forState:UIControlStateNormal];

                    break;
                default:
                    break;
            }
        }
    }
    return self;
}
-(void)btnActions:(UIButton *)btn{
    
    if (btn.tag==10) {
        
        [self removeFromSuperview];
        
    }else{
        
        if (![text1.text isEqualToString:@""]||![text2.text isEqualToString:@""]) {
            AppDelegate *dele=[[UIApplication sharedApplication]delegate];
            dele.server_Address_str=[NSString stringWithFormat:@"http://%@",text1.text];
            dele.push_server_Address=text2.text;
            
            
            text1.text = [text1.text stringByTrimmingCharactersInSet:
                          [NSCharacterSet whitespaceAndNewlineCharacterSet]];
            text2.text = [text2.text stringByTrimmingCharactersInSet:
                          [NSCharacterSet whitespaceAndNewlineCharacterSet]];
            
            
            
            [[NSUserDefaults standardUserDefaults]setObject:text1.text forKey:@"IP"];
            [[NSUserDefaults standardUserDefaults]setObject:text2.text forKey:@"IP2"];
            
            [[NSUserDefaults standardUserDefaults]setObject:nil forKey:@"loginInfo"];
            
            [text2 resignFirstResponder];
            [text1 resignFirstResponder];
            
            self.hidden=YES;
        }else{
            UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@"提示" message:@"请输入服务器IP地址" delegate:nil cancelButtonTitle:@"确定" otherButtonTitles:nil, nil];
            [alert show];
            [alert release];
        }
        

    }
}
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField{
    
    
    [UIView animateWithDuration:0.3 animations:^(void){
    
        backImage.frame=CGRectMake(backImage.frame.origin.x, 748/2-378/2-150, backImage.frame.size.width, backImage.frame.size.height);
    
    
    }];
    
    return YES;
}
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
    
    
    UITouch *touch=[touches anyObject];
    if ([touch view]!=backImage) {
        [UIView animateWithDuration:0.3 animations:^(void){
            
            backImage.frame=CGRectMake(backImage.frame.origin.x,  748/2-378/2, backImage.frame.size.width, backImage.frame.size.height);
            
            
        }];
        [text1 resignFirstResponder];
        [text2 resignFirstResponder];
    }
    
    
    
    
    //[self removeFromSuperview];
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
