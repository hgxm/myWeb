//
//  ManySelectView.m
//  BigClassRoom
//
//  Created by apple  on 13-3-12.
//
//

#import "ManySelectView.h"

@implementation ManySelectView
@synthesize isShowRightAnswer;
- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        
        isShowRightAnswer = 1;
    }
    return self;
}


-(void)changUI:(NSMutableDictionary *)dict daan:(NSMutableDictionary *)answerDict index:(int)i{
    
    to_id = [[dict objectForKey:@"to_id"] intValue];
    
    muAnswerDict = answerDict;//得到答案字典
    
    [self flushSelfView:dict];
}

-(void)flushSelfView:(NSMutableDictionary *)dict{
    
  
    NSString *to_option=[dict objectForKey:@"to_option"];
    NSArray *arr=[to_option componentsSeparatedByString:@","];
    count = [arr count];
    
    for (int i=0; i<[arr count]; i++) {
        
        UILabel *lbl=[[UILabel alloc]initWithFrame:CGRectMake(50, 50*i+50, 25, 25)];
        lbl.backgroundColor=[UIColor clearColor];
        lbl.text=[ToolClass getAnswer:[arr objectAtIndex:i]];
        lbl.textColor=[UIColor colorWithRed:71.0/255 green:92.0/255 blue:109.0/255 alpha:1];
        lbl.textAlignment=NSTextAlignmentLeft;
        [self addSubview:lbl];
        [lbl release];
        
        
        ManyBtn *btn=[[ManyBtn alloc] initWithFrame:CGRectMake(75, 50*i+50, 25, 25)];
        btn.tag=i+10;
        btn.isSelect=NO;
        [btn addTarget:self action:@selector(btnActions:) forControlEvents:UIControlEventTouchDown];
        [btn setImage:[UIImage imageNamed:@"多项.png"] forState:UIControlStateNormal];
        [self addSubview:btn];
        [btn release];
        
        
        
    }
    
    
    NSString *answer = [[[dict objectForKey:@"to_answer"] JSONValue] objectAtIndex:0];
    
    
    UILabel *answerLbl = [[UILabel alloc]initWithFrame:CGRectMake(50, 50*[arr count]+50, 500, 30)];
    answerLbl.backgroundColor = [UIColor clearColor];
    answerLbl.hidden = !isShowRightAnswer;
    answerLbl.text = [NSString stringWithFormat:@"正确答案:\t\t%@",[ToolClass getMoreAnswer:answer]];
    answerLbl.font = [UIFont boldSystemFontOfSize:20];
    answerLbl.textColor = MYCOLOR;
    [self addSubview:answerLbl];
    [answerLbl release];
    
    
    NSString *strDaan = [muAnswerDict objectForKey:[NSString stringWithFormat:@"%d",to_id]];
    if ([strDaan isEqualToString:@"-1"]) {
        
    }else{
        
        NSArray *arrAnwers = [strDaan componentsSeparatedByString:@","];
        for (int i =0; i<[arrAnwers count]; i++) {
            
            [((ManyBtn *)[self viewWithTag:[[arrAnwers objectAtIndex:i]intValue]+10]) setImage:[UIImage imageNamed:@"多项1.png"] forState:UIControlStateNormal];
            ((ManyBtn *)[self viewWithTag:[[arrAnwers objectAtIndex:i]intValue]+10]).isSelect=YES;
        }
    }
    
  
    
}

-(void)btnActions:(ManyBtn *)btn{
    
    
   
    
    if (btn.isSelect==NO) {
        
        [btn setImage:[UIImage imageNamed:@"多项1.png"] forState:UIControlStateNormal];
        btn.isSelect=YES;
        
        
    }else {
        
        
        [btn setImage:[UIImage imageNamed:@"多项.png"] forState:UIControlStateNormal];
        btn.isSelect=NO;
    }
    
    
     NSMutableString *muStr = [[NSMutableString alloc] init];
        for (int i=0; i<count; i++) {
     
            ManyBtn *btn = (ManyBtn *)[self viewWithTag:i+10];
            if (btn.isSelect == YES) {
                [muStr appendFormat:@"%d,",i];
            }
     }
    if ([muStr length]>1) {
     
        NSRange range;
        range.location = [muStr length]-1;
        range.length = 1;
        
        [muStr deleteCharactersInRange:range];
    }
    NSLog(@"muStr is %@",muStr);
    if ([muStr isEqualToString:@""]) {
        [muStr appendString:@"-1"];
    }
     [muAnswerDict setObject:muStr forKey:[NSString stringWithFormat:@"%d",to_id]];
     [muStr release];
     muStr=nil;
    
        NSLog(@"做了作业 is %@",muAnswerDict);
    
  
    
}
-(void)dealloc{
    
    [super dealloc];
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
