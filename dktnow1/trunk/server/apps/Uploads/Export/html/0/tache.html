<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <script type="text/javascript" src="./Js/jquery-1.9.1.js" ></script>
    <script type="text/javascript" src="./Js/public.js" ></script>
    <link href="./Css/public.css" type="text/css" rel="stylesheet">
    <link href="./Css/jquery-ui.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="./Js/jquery-ui.js" ></script>
    <link href="./Css/tache.css" type="text/css" rel="stylesheet">
    <!--[if IE 6]>
    <script type="text/javascript" src="./Js/png.js" ></script>
    <script type="text/javascript">
        DD_belatedPNG.fix('#logo,.cShare,.cEdit,.cIn,.cClone,.cExport,.cDel,.fw_baoming_left,.fw_btn,.anli_ico_link,.anli_ico,.selected,.selected_green,.selected_gray,.to-left,.to-right,.current,.mt_tab li,.classhomework_top li,.choose_class,.current img,.res_click,.res_scan,.res_frame.png,#main_bg li img,.jCal .left,.jCal .right');
    </script>
    <![endif]-->
    <title>大课堂互动教学</title>
    <script>
    // 导航动画效果
    $(function(){
        $('#header li a').wrapInner('<span class="out"></span>');

        $('#header li a').each(function() {
            $('<span class="over">' + $(this).text() + '</span>').appendTo(this);
        });

        $('#header li a').hover(function() {
            $('.out',this).stop().animate({'top':'67px'},200);
            $('.over',this).stop().animate({'top':'0px'},200);

        }, function() {
            $('.out',this).stop().animate({'top':'0px'},200);
            $('.over',this).stop().animate({'top':'-67px'},200);
        });
        
        $('#header li a').click(function(){

            // 选中菜单项的样式
            $(this).addClass('on').parent().siblings().find('a').removeClass('on');

            // 恢复动画
            $('.out',this).css('top','0px');
            $('.over',this).css('top','-67px');
            $(this).parent().siblings().find('a').hover(function(){
                $('.out',this).stop().animate({'top':'67px'},200);
                $('.over',this).stop().animate({'top':'0px'},200);
            }, function() {
                $('.out',this).stop().animate({'top':'0px'},200);
                $('.over',this).stop().animate({'top':'-67px'},200);
            })
            // 停止当前点击导航的动画效果
            $(this).hover(function(){
                $('.out',this).stop();
                $('.over',this).stop();
            },function(){
                $('.out',this).stop();
                $('.over',this).stop();
            })
        }).eq(0).click();
    })
    </script>
</head>
<body id="body">
    <div id="header">
        <div>
            <a href="javascript:void(0);" id="logo"></a>
            <ul class="nav">
                <li><a href="javascript:;">课程超市</a></li>
                <li><a href="javascript:;">我的空间</a></li>
                <li><a href="javascript:;">资源中心</a></li>
                <li><a href="javascript:;">应用中心</a></li>
            </ul>
            <a href="javascript:void(0);" class="download">iPhone客户端下载</a>
        </div>
    </div>
    <div class="warp">
    <div id="main">
        <div class="main_hea fl">
            <a class="back" href="javascript:history.go(-1)">返回</a>
            <a></a>
            <span></span>
            <a></a>
            <span>></span>
            <a class="hea_class"></a>
        </div>
        <div class="clear"></div>
        <div class="main_main">
            <ul class="main_new">
                <a href="javascript:void(0);" class="main_join">浏览</a>
            </ul>
            <div class="clear"></div>
            <div class="new_tab">
                <div class="temp_bottom">
                    <span class="temp_teach fl">教学活动</span>
                    <div class="temp_text fl">
                        <div class="temp_flex">
                        </div>
                   </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
    </div>
    <div class="clear"></div>
    <div class="foot_bot"></div>
    <div class="foot_top"></div>
    <div id="footer">
        <div class="nav back1"></div>
        Copyright &copy; 2007-2011 北京金商祺移动互联 All Rights Reserved.
    </div>
    <script>
        <!--//
            $(function(){

                // 切换li 滑过，滑开
                $(document).on('mouseover','.main_new li',function(){
                    $(this).children('span').show();
                    $(this).children('a').show();
                }).on('mouseout','.main_new li',function(){
                    $(this).children('span').hide();
                    $(this).children('a').hide();
                })

                // 修改环节
                $(document).on('focus', '.main_new li input', function () {
                }).on('blur','.main_new li input',function(){
                })

                // 切换li下 a 点击事件
                $(document).on('click','.main_new li a',function(){

                    var flag = true;
                    var tIndex = $(this).parents('li').index();

                    $('.main_new p').each(function(){
                        if ($(this).css('display') == 'none' && $(this).index() != tIndex) {
                            flag = false;
                        }
                    })

                    if (flag == false) {
                        $('.main_new li input').each(function() {
                            $(this).blur();
                        })
                    }

                    $(this).siblings('input').show().siblings('p').hide();
                    $(this).siblings('input').focus();
                })

                // 切换li下 a 滑过事件
                $(document).on('mouseover','.main_new li a',function(){
                    $(this).show();
                })

                // 切换li下 p 点击 tab 切换事件
                $(document).on('click','.main_new li p',function(){
                    $(this).parent().addClass('new_click').siblings().removeClass('new_click');
                    $(".new_tab>div").eq($(this).parent().index()-1).show().siblings().hide();

                    // 获取被选中的环节ID
                    var ta_id = $('.main_new .new_click').attr('rel');
                    syncActivity(ta_id);
                })

                // 切换li下span 删除事件
                $(document).on('click','.main_new li span',function(){
                })

                // 弹窗里的课目显示
                $('.add_link div').click(function() {
                    $(this).addClass("add_div").siblings().removeClass("add_div");
                })

                // 获取所选中的环节下所有的活动ID，传到show.html页面
                $(document).on('click', '.main_join', function () {
                    var act_id = '';
                    $('.flex_add').each(function () {
                        act_id += '|' + $(this).attr('attr') + ':' + $(this).attr('rel') + ':' + $(this).attr('toId');
                    })
                    act_id = act_id == '' ? '' : act_id.slice(1);
                    location.href = './show.html?act_id=' + act_id + '&co_id=' + co_id + '&l_id=' + l_id + '&cl_id=' + cl_id + '&ta_id=' + $('.main_new .new_click').attr('rel');
                })

                // 单击环节下的单个活动时进行跳转
                $(document).on('click', '.flex_add', function () {
                    location.href = './show.html?act_id=' + $(this).attr('attr') + ':' + $(this).attr('rel') + ':' + $(this).attr('toId') + '&co_id=' + co_id + '&l_id=' + l_id + '&cl_id=' + cl_id + '&ta_id=' + $('.main_new .new_click').attr('rel');
                })

                // 单击环节下的作业，进去相关的编辑页面
                $(document).on('click', '.temp_flex .new_work .flex_book', function () {
                })

                // 单击环节下的练习，进去相关的编辑页面
                $(document).on('click', '.temp_flex .add_blue .flex_book', function () {
                })

                var cl_id = getParameter("cl_id");
                var l_id = getParameter("l_id");
                var co_id = getParameter("co_id");

                $.post('./Data/tache.txt', '', function (json) {

                    var html = '';
                    for (var i=0; i< json.length; i++) {
                        if (cl_id != json[i]['cl_id']) {
                            continue;
                        }
                        html += '<li rel="' + json[i]['ta_id'] + '">'
                             +  '<p>' + json[i]['ta_title'] + '</p>'
                             +  '</li>'
                    }
                    $('.main_new').append(html);

                    // 如果添加的课时数大于1，那么就默认选中第二个，否则就是本身
                    var initNum = $('.main_new li').size() > 1 ? 1 : 0;
                    $('.main_new p').eq(initNum).click();

                    // 获取被选中的环节ID
                    var ta_id = $('.main_new .new_click').attr('rel');
                    syncActivity(ta_id);

                }, 'json');

                setLesson(l_id);
                setClasshour(cl_id);
            })

            // 获取课时
            function setClasshour(cl_id) {

                $.getJSON("./Data/classhour.txt", function(json) {
                    $.each(json, function(i, data){
                        if (data['cl_id'] == cl_id) {
                            $('.main_hea a.hea_class').html(data['cl_title']);
                        }
                    })
                });
            }

            // 获取课文
            function setLesson(l_id) {

                $.getJSON("./Data/lesson.txt", function(json) {
                    var str = '';
                    var pId = 0;
                    $.each(json, function(i, data){
                        if (data['id'] == l_id) {
                            str = data['name'];
                            pId = data['pId'];
                        }
                    })

                    $.each(json, function(i, data){
                        if (data['id'] == pId) {
                            str = data['name'] + '>' + str;
                        }
                    })

                    $('.main_hea a').eq(2).html(str);
                })
            }

            // 依据活动类型，返回相应的样式
            function getActivityType(type) {
                switch (parseInt(type)) {
                    case 1:
                        return 'new_work';
                        break;
                    case 2:
                        return 'add_blue';
                        break;
                    case 3:
                        return 'add_act';
                        break;
                    case 4:
                        return 'link';
                        break;
                    case 5:
                        return 'res_read';
                        break;
                }
            }

            // 获取url传参
            function getParameter(param) {
                var query = window.location.search;
                query = '&' + query.slice(1);
                param = '&' + param + '=';
                var iLen = param.length;
                var iStart = query.indexOf(param);
                if (iStart == -1) {
                    return "";
                }
                iStart += iLen;
                var iEnd = query.indexOf("&", iStart);
                if (iEnd == -1) {
                    return query.substring(iStart);
                }
                return query.substring(iStart, iEnd);
            }

            // 异步加载环节下的活动
            function syncActivity(ta_id) {
                var html = ''
                $.post('./Data/activity.txt', '', function (json) {

                    for (var i=0; i< json.length; i++) {
                        if (ta_id != json[i]['ta_id']) {
                            continue;
                        }
                        html += '<div class="flex_add ' + getActivityType(json[i]['act_type']) + '" rel="' + json[i]['act_id'] + '" attr="' + json[i]['act_type'] + '" toId="' + json[i]['act_rel'] + '" >'
                             +  '<a href="javascript:void(0);" class="flex_book">'
                             +  '<div class="add_book">'
                             +  '<div class="add_ico fl"></div>'
                             +  '<div class="add_caption fl"></div>'
                             +  '</div>'
                             +  '<div class="add_label">' + json[i]['act_title'] + '</div>'
                             +  '</a>'
                             +  '</div>'
                    }
                    $('.temp_flex').html(html);
                }, 'json');
            }
        //-->
    </script>
</body>
</html>