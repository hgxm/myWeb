<include file="Public:header"/>
<load href="__PUBLIC__/Css/Ilc/user.css"/>
<script type="text/javascript">
// 表格排列
var listObj =  {"_tcheck": '8%',"_tnumber": "10%" ,"_username": "10%","_txm": "10%","_bj": "15%",'_phone':"10%",'_tloginNum':"10%",'_loginIp':'8%','_status':'8%','_toperate':'10%','_edit':'5%'};
$(function(){

    setWidth(listObj);

    $('.search_btn').click(function(){
        getStudentList();
    });

    // 启用禁用
    $(document).on('click', '._statusText', function() {
        var status = $(this).parents('.plist').find('._status').attr('attr');
        var id = $(this).parents('.plist').attr('attr');
        status = status == 1 ? 1 : 0;
        forbid(id, status);
    })

    // 编辑
    $(document).on('click', '._edit', function() {
        location.href = '__URL__/edit/id/'+$(this).parents('.plist').attr('attr');
    })

    // 排序
    $('._ptitle li.sortby').click(function(){

        // 点击选中,取消
        if ($(this).attr('attr') != undefined) {
            if ($(this).hasClass('on')) {
                $(this).removeClass('on');
            } else {
                $(this).addClass('on');
            }
        }

        getStudentList();


    }).eq(0).click();
});

// 获取学生列表
function getStudentList(p) {

    p = p ? p :1;

    var a_nickname = $('input[name=a_nickname]').val();

    // 遍历获取排序
    var order = '';
    $('._ptitle li.sortby').each(function(){

        if ($(this).attr('attr') != undefined) {

            if ($(this).hasClass('on')) {
                order += ',' + $(this).attr('attr') + ' ASC';
            } else {
                order += ',' + $(this).attr('attr') + ' DESC';
            }
        }

    });

    order = order.slice(1);



    $.post('__URL__/lists', 'p='+p+'&is_ajax=1&a_nickname='+a_nickname+'&order='+order, function(json){
        var obj = json.list;
        var str = '';

        if (obj) {
            if (json.status) {

                for (var i = 0; i < obj.length; i ++) {
                    var c_name = obj[i]['c_name'].substr(0, 8);

                    str += '<div class="_caption _List plist" attr="'+obj[i]['a_id']+'"><ul><li class="_tcheck"><input type="checkbox" name="key" value="'+obj[i]['a_id']+'"></li><li class="_tnumber" title='+obj[i]['a_id']+'>'+obj[i]['a_id']+'</li><li class="_username" title='+obj[i]['a_account']+'>'+obj[i]['a_account']+'</li><li class="_txm" title='+obj[i]['a_nickname']+'>'+obj[i]['a_nickname']+'</li><li class="_bj" title="'+obj[i]['c_name']+'">'+c_name+'</li><li class="_phone" title='+obj[i]['a_tel']+'>'+obj[i]['a_tel']+'</li><li class="_tloginNum" title='+obj[i]['a_login_count']+'>'+obj[i]['a_login_count']+'</li><li class="_loginIp" title='+obj[i]['a_last_login_ip']+'>'+obj[i]['a_last_login_ip']+'</li><li class="_status"  attr="'+obj[i]['a_status']+'">';

                    if (obj[i]['a_status'] == 1) {
                        str += '<img src="__APPURL__/Public/Images/Ilc/qy_status.png" />';
                    } else {
                        str += '<img src="__APPURL__/Public/Images/Ilc/jy_status.gif" />';
                    }

                    str += '</li><li class="_statusText">';

                    if (obj[i]['a_status'] == 1) {
                        str += '禁用';
                    } else {
                        str += '启用';
                    }

                    str += '</li><li class="_edit">编辑</li></ul></div>';

                }
            }
        } else {
            str += '<div class="pli_null">暂无数据</div>';
        }

        $('#data').html('');
        $('#data').html(str);
        $('.page').html(json.page);

        setWidth(listObj);

    }, 'json');


}

function getList(p) {
    getStudentList(p);
}

// 判断回车
function keydown(e){
    var e = e || event;
    if (e.keyCode==13) {
        $(".search_btn").click();
    }
}

</script>
<div class="warp">
    <include file="Public:left"/>
    <div class="user fl">
        <div class="user_menu">
             <volist name="secondList" id="selist">
                <a href="__APPURL__{$selist['sn_url']}" <eq name="selist.sn_name" value="Student">class="selected"</eq>>{$selist['sn_title']}</a>
            </volist>
        </div>
        <div class="filter">
            <div class="tools fl">
                <span class="add"><i></i>新增</span>
                <span class="edit"><i></i>编辑</span>
                <span class="del"><i></i>删除</span>
                <span class="forbidden"><i></i>禁用</span>
                <span class="resume"><i></i>启用</span>
            </div>
            <p>
                <label>学生姓名：</label>
                <input type="text" name="a_nickname" onkeydown="keydown(event)">
                <a href="javascript:void(0);" class="search_btn"></a>
            </p>
        </div>


        <div class="AuthStudent_list fl" id="studentList">
            <div class="_caption _ptitle t_caption">
                <ul>
                    <li class="_tcheck"><input type="checkbox" onclick="CheckAll('studentList')"></li>
                    <li class="_tnumber sortby" attr="a_id">编号</li>
                    <li class="_username">用户名</li>
                    <li class="_txm">姓名</li>
                    <li class="_bj">班级</li>
                    <li class="_phone">手机</li>
                    <li class="_tloginNum">登陆次数</li>
                    <li class="_loginIp">登陆IP</li>
                    <li class="_status">状态</li>
                    <li class="_toperate">操作</li>
                </ul>
            </div>
            <div id="data">

            </div>
    </div>
    <div class="page"></div>

    <div class="clear"></div>
</div>
<include file="Public:footer"/>