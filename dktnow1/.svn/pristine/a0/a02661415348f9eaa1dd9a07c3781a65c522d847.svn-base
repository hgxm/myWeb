<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/upgrade.css"/>
<load href="__PUBLIC__/Css/Home/jquery-ui.css"/>
<load href="/Public/Home/jquery-ui.js"/>
<load href="/Public/Js/Public/provincesCity.js,/Public/Js/Public/provincesdata.js"/>
    <script type="text/javascript">
    <!--
        $(function() {

            // 用户申请
            $(document).on('click', '.apply', function(){

                var type = $(this).attr('type');
                var c_id = $(this).attr('attr');
                var s_id = $(this).attr('rel');

                $.post('__APPURL__/ApplyAuth/applyTo', 's_id='+s_id+'&c_id='+c_id+'&type='+type, function(json){

                    if (json.status) {

                            showMessage('申请成功', 1);

                    } else {
                        showMessage(json.info);
                    }
                }, 'json');

            });

            $('.applyClass').click(function() {
                location.href = '__APPURL__/ApplyClass/index/s_id/'+$('.out').attr('attr');
            })

            // 班级tab切换
            $(document).on('click', ".class_tab li", function(){

                $(this).addClass("current").siblings().removeClass("current");
                $('.class_list_box .eb').eq($(this).index()).show().siblings().hide();
            })

            // 选择学校窗口
            $("input[name='chooseSchool']").focusin(function(){

                $('.choose_list').show();
            })

            // 关闭选择学校窗口
            $('.close_choose_list').click(function(){

                $(this).parent().parent().hide();
            })

            // 学校所在地联动
            setProvince("province", "a_region", '');

            // 异步加载学校
            $("input[name=confirm]").click(function(){
                ShowSchool();
            })

            // 选择学段异步加载学校
            $('input[name=choose_school]').click(function(){

                if ($('.choose_list').css('display') == 'block') {
                    ShowSchool();
                }
            });

            // 选择学校获取班级
            $(document).on('click','.school', function(){

                // 输入框显示选择的学校
                $('input[name=chooseSchool]').val($(this).html());

                // 设置当前选择学校的id
                $('.out').attr('attr', $(this).attr('attr'));

                // 显示班级
                searchClass($(this).attr('attr'), $(this).attr('type'));
                $('.close_choose_list').click();
            });

            //批量注册 a 连接
            $('.applyClass a').click(function(){
                  document.location.href="javascript:void(0);";
            })
        })

        // 显示学校
        function ShowSchool(){

            // 获取学段,和地区
            var xueduan = $('input[name=choose_school]:checked').attr('attr');
            var region = $('input[name=a_region]').val();

            if(region == '######'){
                region = '';
            }

            $('.out').attr('attr', '');

            // 获取学校数据
            $.post('__APPURL__/School/getSchoolByRegion', 'xueduan='+xueduan+'&region='+region, function(json) {

                var str = '';
                var obj = json.list;
                if (json.status == 1) {

                    str += '<ul>';
                    if (obj) {
                        for (var i = 0; i < obj.length; i++) {
                            str += '<li attr="'+obj[i]['s_id']+'" type="'+obj[i]['s_type']+'" class="school">'+obj[i]['s_name']+'</li>';
                        }
                    }
                    str += '</ul>';
                    $('.out').attr('attr', obj[0]['s_id']);
                } else {
                    str += json.info;
                }

                $('.search_result').html('');
                $('.search_result').append(str);

            }, 'json');
        }

        // 显示班级
        function searchClass(s_id, s_type){

            var classList = "";
            $('.applyClass').show();

            if(s_id && s_type){

                // 获取班级数据
                var classList = '';
                $('.insert_list').html('');
                $.post('__APPURL__/Class/lists', 's_id='+s_id+'&s_type='+s_type+'&g_order=1&is_ajax=1', function(json){

                    if (!json) {
                        $('.applyClass').show();$('.class_tab li').eq(0).click();return false;
                    }

                    // 列举年级
                    classList += '<ul class="class_tab">';

                    for (var i = 0; i < json.length; i++) {
                        classList += '<li>'+json[i]['name']['name']+'</li>';
                    }

                    classList += '</ul>';
                    classList += '<div class="class_list_box">'

                    // 列举班级

                    for (var j = 0; j <json.length; j++ ) {

                        classList += '<div class="eb hide"><ul>';
                        var obj = json[j]['lists'];
                        for (var k = 0; k < obj.length; k ++) {
                            classList += '<li><div class="box_left fl"><a href="#"><img src="'+obj[k]['classLogo']+'"/></a><p class="class_name"><a href="#">'+obj[k]['c_name']+'</a><span>'+obj[k]['c_name']+'</span></p></div><p class="box_right fr"><a href="javascript:void(0);" type="2" class="apply" attr="'+obj[k]['c_id']+'"  rel="'+s_id+'">申请为老师</a>';

                            if ({$authInfo['a_type']} != 2) {
                                classList += '<a href="javascript:void(0);" type="1" class="apply"  attr="'+obj[k]['c_id']+'" rel="'+s_id+'">申请为学生</a>';
                            }

                            //classList += '<a href="#">查看资料</a></p></li>';
                        }
                        classList += '</ul></div>';
                    }


                    classList += '</div>';

                    $('.insert_list').html('');
                    $('.insert_list').append(classList);

                    $('.class_tab li').eq(0).click();

                }, 'json');

            }

        }

    //-->
    </script>

    <div class="warp">
        <input type="hidden" value="" id="dialog_c_id" />
        <input type="hidden" value="" id="dialog_s_id" />
        <include file="Public:leftSider"/>
        <div class="mainBox fl">
            <a class="proof_back fl">&nbsp;&nbsp;&nbsp;&nbsp;申请加入</a>
            <notempty name="flag"><a class="proof_back fl" style="float:right" href="__APPURL__/Class/">&nbsp;&nbsp;&nbsp;&nbsp;返回</a></notempty>

            <div class="choose_school fl">
                <h1>选择学校</h1>
                <div class="in">
                    <label>所在学校：</label>
                    <p class="school_list">
                        <volist name="schoolType" id="schoolType">
                            <span><input type="radio" name="choose_school" attr="{$key}">{$schoolType}</span>
                        </volist>
                    </p>
                </div>
                <div class="out">
                    <label>选择学校：</label>
                    <input type="text" name="chooseSchool">
                </div>
                <div class="choose_list">
                    <p>
                        <span class="close_choose_list"></span>
                        <span><cite>选择学校</cite> - 学校按名称的拼音顺序排列，同按ctrl+F键可进行搜索</span>
                    </p>
                    <div class="school_address fl">
                        <label class="addr">学校所在地：</label>
                        <span id="province"></span>
                        <input type="button" name="confirm" value="确定" />
                        <input type="hidden" name="a_region"/>
                    </div>
                    <div class="search_result fl">

                    </div>

                    <a class="addlink fr" href="__APPURL__/ApplySchool/">还没有我的学校，<cite>申请添加</cite></a>
                </div>

            </div>

            <div class="choose_class fl">
                <div class="tit">
                    <h1><span>选择班级</span></h1>
                    <p class="applyClass" style="display:none"><a>没有我的班级？<cite>点击批量注册</cite></a><p>
                </div>
                <div class="insert_list">

                </div>
                <div style="clear:both"></div>
                <p class='noclass' style="display:none">该年级还没有老师建立班级！请联系你的老师.</p>
            </div>

        </div>
        <div class="clear"></div>
    </div>
<include file="Public:footer"/>