<include file="Public:header"/>
<load href="__PUBLIC__/Css/Ilc/lead.css"/>
<load href="__PUBLIC__/Css/Ilc/model.css"/>
<load href="__PUBLIC__/Css/Ilc/exmine_cour.css"/>

<eq name="data['re_is_transform']" value="1">
    <!--文档-->
    <eq name="data['m_id']" value="4">
        <load href="/Public/Js/Public/flexPlugin/js/flexpaper.js, /Public/Js/Public/flexPlugin/js/flexpaper_handlers.js" />
    </eq>

    <!--视频-->
    <eq name="data['m_id']" value="2">
        <load href="__PUBLIC__/Css/Home/vedio.css"/>
        <load href="/Public/Js/Home/ckplayer/ckplayer.js"/>
        <script>
            var flashvars={
                f:'{$data["filePath"]}',//视频地址
                c:'0',
                e:'1',//视频结束后的动作，0是调用js函数，1是循环播放，2是暂停播放，3是调用视频推荐列表的插件，4是清除视频流并调用js功能和1差不多
                p:'1',//视频默认0是暂停，1是播放
                g:'0',//视频直接g秒开始播放
                };
            var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always'};
            var attributes={id:'ckplayer_a1',name:'ckplayer_a1'};
            swfobject.embedSWF('/Public/Js/Home/ckplayer/ckplayer.swf', 'a1', '598', '408', '10.0.0','/Public/Js/Home/ckplayer/expressInstall.swf', flashvars, params, attributes); //播放器地址，容器id，宽，高，需要flash插件的版本，flashvars,params,attributes

            var watchtime;
            var wattime=-1;
            var watt=false;//默认没有计时
            var ptime=0;
            function aboutstr(str,f) {
                //查看str字符里是否有f
                var about=false;
                var strarray=new Array();
                var farray=new Array();
                farray=f.split(",");
                if(str) {
                    for(var i=0;i<farray.length;i++){
                        strarray=str.split(farray[i]);
                        if(strarray.length>1){
                            about=true;
                            break;
                        }
                    }
                }
                return about;
            }

            // 实时的监听播放器里各状态的值
            function ckplayer_status(str){

                if(str=='103' || str=='101'){
                    if(watt){
                        watt=false;
                        window.clearInterval(watchtime);
                    }
                }
                // 获取当前播放时间
                if(aboutstr(str,'nowtime:')){
                    ptime = parseInt(str.replace('nowtime:',''));
                    var twoStep  = ptime.toFixed(2);
                    var millisecond = parseFloat(twoStep)*1000;
                    var newTime = new Date(millisecond);
                    var hours = parseFloat(newTime.getHours() - 8);
                    var minutes = parseFloat(newTime.getMinutes());
                    var second = parseFloat(newTime.getSeconds());
                    if (hours < 10) {
                        hours = '0' + parseFloat(newTime.getHours() - 8);
                    }
                    if (minutes < 10) {
                        minutes = '0' + newTime.getMinutes();
                    }
                    if (second < 10) {
                        second = '0' + newTime.getSeconds();
                    }
                    var formatTime = hours + ":" + minutes + ':' + second;
                    document.getElementById('currentTime').innerHTML = formatTime;
                }
            }

            // 暂停视频并获取当前播放时间点
            function getTime(){
                swfobject.getObjectById('ckplayer_a1').ckplayer_pause();
            }
        </script>
    </eq>

    <!--音频-->
    <eq name="data['m_id']" value="3">
        <load href="__PUBLIC__/Js/Home/jplayer/skin/jplayer.blue.monday.css" />
        <load href="/Public/Js/Home/jplayer/js/jquery.jplayer.min.js" />
        <script>
            $(function () {
                $("#jquery_jplayer_1").jPlayer({
                    ready: function () {
                        $(this).jPlayer("setMedia", {
                            m4v: "{$data['filePath']}",
                            poster: "http://www.jplayer.org/video/poster/Big_Buck_Bunny_Trailer_480x270.png"
                        });
                    },
                    swfPath: "js",
                    supplied: "m4v",
                    size: {
                        width: "650px",
                        height: "360px",
                        cssClass: "jp-video-360p"
                    }
                });
            })
        </script>
    </eq>
</eq>

<script type="text/javascript">
<!--
    $(function(){

        // 栏目选择
        $(document).on('click', '.choose', function() {
            getChild(0, 1);
        })

        // 获取子栏目
        $(document).on('click', '.list li', function() {

            var level = $(this).attr('level');
            $('.list li').each(function() {
                if ($(this).attr('level') > level) {
                    $(this).remove();
                }
            })
            $(this).addClass('on').siblings().removeClass('on');
            getChild($(this).attr('attr'));
        })

    })

    function getChild(id, type) {

        var str = '';

        if (type == 1) {

            if ($('.list li').size() == 0) {

                str += '<li attr="0" level="0" type="{$authInfo[\'s_id\']}">本校栏目</li>';
                $('.list ul').html(str);
                $('.list').show();return;

            }
        } else {

            if ($('.list').css('display') == 'none') {
                $('.list').show();
            } else {
                $.post('__URL__/findSub', 'id='+id, function(json) {
                    var str = '';

                    if (json) {
                        $.each(json, function(i, data){

                            if (data['rc_pid'] == id && data['s_id'] == $('.list li.on').attr('type')) {
                                str += '<li attr="' + data['rc_id'] + '" level="' + data['rc_level'] + '" type="' + data['s_id'] + '">' + getLevel(data['rc_level']) + data['rc_title'] + '</li>';
                            }
                        })
                    }

                    if (!str) {
                        var t_val = $('.list li.on').html();
                        var reg=/&nbsp;/g;
                        var new_val = t_val.replace(reg,'');
                        $('.choose').html(new_val);
                        $('input[name=rc_id]').val($('.list li.on').attr('attr'));
                        $('.list.on').removeClass('on');
                        $('.list').hide();
                    } else {
                        $(str).insertAfter($('.list li.on'));
                        $('.list').show();
                    }

                }, 'json')
            }
        }
    }

    function getLevel(level) {

        var result = '';
        for (var i = 0; i < level; i ++) {

            result += '&nbsp;&nbsp;&nbsp;&nbsp;';
        }

        return result;
    }
//-->
</script>


<div class='warp'>
<include file="Public:left"/>
<div class="colu_right">
    <div class="colu_main lead_center">
    <form name="form1" action="__URL__/update" method="post">
    <input name="re_id" value="{$data['re_id']}" type="hidden" />
    <input name="rc_id" value="" type="hidden" />

        <div class="title">
            <i class="fl">资源编辑</i>
            <a class="fr" href="__APPURL__/Ilc/Resource/">返回列表</a>
        </div>
        <ul class="exa_cour">
            <li>
                <label>学校：</label>
                <p>{$data.s_name}</p>
            </li>
            <li>
                <label>上传人：</label>
                <p>{$data.a_nickname}</p>
            </li>
            <li>
                <label>资源名称：</label>
                <p><input type="text" value="{$data['re_title']}" name="re_title" /></p>
            </li>
            <li>
                <label>下载积分：</label>
                <p>{$data['re_download_points']}分</p>
            </li>
            <li>
                <label>所属栏目：</label>
                <p><if condition="$data.rc_title neq ''">{$data.rc_title}<else />无</if></p>

                <div class="pub_name">
                    <span class="choose" style="margin-left:100px;">选择</span>

                    <div class="list">
                        <ul>

                        </ul>
                    </div>
                </div>
            </li>
            <if condition="$data['re_is_transform'] neq 1">
                <li>
                    <label>资源下载：</label>
                    <div>

                        <div class="r_play">
                            <div><a href="__URL__/download/id/{$data['re_id']}">{$data['re_title']}下载</a></div>
                        </div>

                    </div>
                </li>
            <else />
                <eq name="data['m_id']" value="1">
                    <li>
                        <label>资源预览：</label>
                        <div><img src="{$data['filePath']}" /></div>
                    </li>
                </eq>
                <eq name="data['m_id']" value="2">
                    <li>
                        <label>资源预览：</label>
                        <div>
                            <div class="r_play">
                                <div id="video" style="position:relative;z-index: 100;width:658px;height:408px;float: left;margin-bottom:10px;"><div id="a1"></div></div>
                            </div>
                        </div>
                    </li>
                </eq>
                <eq name="data['m_id']" value="3">
                    <li>
                        <label>资源预览：</label>
                        <div>
                            <!-- 音频播放 -->
                            <div id="jp_container_1" class="jp-video jp-video-360p"  style="width:650px;">
                                <div class="jp-type-single">
                                    <div id="jquery_jplayer_1" class="jp-jplayer"></div>
                                    <div class="jp-gui">
                                        <div class="jp-video-play">
                                            <a href="javascript:;" class="jp-video-play-icon" tabindex="1">play</a>
                                        </div>
                                        <div class="jp-interface">
                                            <div class="jp-progress">
                                                <div class="jp-seek-bar">
                                                    <div class="jp-play-bar"></div>
                                                </div>
                                            </div>
                                            <div class="jp-current-time"></div>
                                            <div class="jp-duration"></div>
                                            <div class="jp-controls-holder">
                                                <ul class="jp-controls">
                                                    <li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
                                                    <li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
                                                    <li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
                                                    <li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
                                                    <li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
                                                    <li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
                                                </ul>
                                                <div class="jp-volume-bar">
                                                    <div class="jp-volume-bar-value"></div>
                                                </div>
                                                <ul class="jp-toggles">
                                                    <li><a href="javascript:;" class="jp-full-screen" tabindex="1" title="full screen">full screen</a></li>
                                                    <li><a href="javascript:;" class="jp-restore-screen" tabindex="1" title="restore screen">restore screen</a></li>
                                                    <li><a href="javascript:;" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>
                                                    <li><a href="javascript:;" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>
                                                </ul>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </eq>
                <eq name="data['m_id']" value="4">
                    <li>
                        <label>资源预览：</label>
                        <div class="fl">
                            <div id="documentViewer" class="flexpaper_viewer" style="width:658px;height:500px;margin-bottom:10px;"></div>
                            <script type="text/javascript">
                                $('#documentViewer').FlexPaperViewer(
                                    { config : {
                                        SWFFile :'{$data["filePath"]}',
                                        Scale : 0.6,
                                        ZoomTransition : 'easeOut',
                                        ZoomTime : 0.5,
                                        ZoomInterval : 0.2,
                                        FitPageOnLoad : true,
                                        FitWidthOnLoad : false,
                                        FullScreenAsMaxWindow : false,
                                        ProgressiveLoading : false,
                                        MinZoomSize : 0.2,
                                        MaxZoomSize : 5,
                                        SearchMatchAll : false,
                                        InitViewMode : 'Portrait',
                                        RenderingOrder : 'flash,html',
                                        StartAtPage : '',
                                        ViewModeToolsVisible : true,
                                        ZoomToolsVisible : true,
                                        NavToolsVisible : true,
                                        CursorToolsVisible : true,
                                        SearchToolsVisible : true,
                                        WMode : 'window',
                                        localeChain: 'en_US'
                                    }}
                                );
                            </script>
                        </div>
                    </li>
                </eq>

            </if>

            <li class="coBtn">
                <button class="save" value="" type="submit">保存</button>

            </li>
        </ul>
        </form>
    </div>
</div>
</div>
<include file="Public:footer"/>