<include file="../Public/header_main" />

<load file="__PUBLIC__/Css/Ilc/system_add.css"/>
    <div class="title_hea">
        <i class="fl">添加班级</i>
        <a href="__URL__/">返回列表</a>
    </div>
    <form method="post" action="__URL__/insert/" onsubmit="return check();">
        <ul class="add_option">
            <li>
                <label>学校：</label>
                <select name="s_id">
                    <option attr="" value="0">请选择</option>
                    <volist name="school" id="school">
                    <option value="{$school.s_id}" attr="{$school.s_type}">{$school.s_name}</option>
                    </volist>
                </select>
            </li>
            <li>
                <label>学制：</label>
                <select name="c_type">
                    <option value="0">请选择</option>
                </select>
            </li>
            <li class="major">
                <label>专业：</label>
                <select name="ma_id">
                    <option >请选择...</option>
                </select>
            </li>
            <li>
                <label>学年：</label>
                <select name="c_grade">
                    <option >请选择</option>
                </select>

            </li>

            <li>
                <label>班级名称：</label>
                 <select name="c_id">
                    <option value=0>请选择</option>
                </select>
            </li>

            <li class="coBtn">
                <input type="hidden" value="2" name="a_type"/>
                <button class="save fin" value="" type="submit">保存</button>
                <button class="reset fin" value="" type="reset">清除</button>
            </li>
        </ul>
    </form>

    <script type="text/javascript">

    $(function () {

        // 隐藏专业ID
        $('.major').hide();

        // 通过学校获取学段
        $('select[name=s_id]').change(function() {
            $('select[name=c_type]').html('<option value="0">请选择</option>');
            $('select[name=c_grade]').html('<option value="0">请选择</option>');
            $('.major').hide();
            $('select[name=c_id]').html('<option value="0">请选择</option>');
            // 获取学段
            var sType = $('select[name=s_id] option:selected').attr('attr');
            var str = '<option value="0">请选择</option>';
            if (sType != '') {
                var typeArr = sType.split(',');

                for (var p in typeArr) {

                    str += '<option value="'+typeArr[p]+'">'+$('.schoolType span').eq(typeArr[p] - 1).html()+'</option>';
                }
            }
            $('select[name=c_type]').html(str);
        })

        // 通过学段获取年级
        $('select[name=c_type]').change(function() {
            if ($(this).val() == 4) {
                $('.major').show();
                listGradeOption($('select[name=s_id]').val(), $(this).val(), 'ma_id');
            } else {
                $('.major').hide();
                listGradeOption($('select[name=s_id]').val(), $(this).val(), 'c_grade');
            }
        })

        // 通过专业获取年级
        $(document).on('change', 'select[name=ma_id]', function () {
            listGradeOption($('select[name=s_id]').val(), $(this).val(), 'c_grade', 0, 'major');
        })

        //获得未增加的班级
        $('select[name=c_grade]').change(function(){
            $('select[name=c_id]').html('<option value="0">请选择</option>');
            //获取数据
            var s_id = $('select[name = s_id]').val();
            var c_type = $('select[name = c_type]').val();
            var c_grade = $('select[name = c_grade]').val();
            var ma_id = $('.major').css('display') == 'none' ? 0 : $('select[name = ma_id]').val();

            if (s_id == 0) {
                alert('请选择学校');
                return;
            }

            $.post('__URL__/getClass/s_id/'+s_id+'/c_type/'+c_type+'/c_grade/'+c_grade+'/ma_id/'+ma_id, function(msg){
                $('select[name=c_id]').html('<option value=0>请选择</option>');
                for(i = 0 ; i < msg.length ; i ++){
                    $('select[name=c_id]').append('<option value= '+ msg[i] +'>'+ msg[i] +'</option>');
                }
            },'json')
        })
    })

    //验证
    function check(){
        if($('select[name = s_id]').val() == 0){
            alert('请选择学校');
            return false ;
        }
        if($('select[name = c_type]').val() == 0){
            alert('请选择学制');
            return false ;
        }
        if($('select[name = c_id]').val() == 0){
            alert('请选择班级');
            return false ;
        }
    }

</script>
<div class="schoolType" style="display:none;">
    <volist name="schoolType" id="schoolType">
        <span>{$schoolType}</span>
    </volist>
</div>

