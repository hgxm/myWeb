//
//  PlayViewController.m
//  ClassRoomTeacher
//
//  Created by apple  on 13-7-5.
//  Copyright (c) 2013年 apple . All rights reserved.
//

#import "PlayViewController.h"

@interface PlayViewController ()

@end

@implementation PlayViewController
@synthesize strURL;
@synthesize type;
- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    
    
    self.view.backgroundColor = [UIColor blackColor];
    
    if (type == 1) {//播放本地
         player = [[MPMoviePlayerController alloc]initWithContentURL:[NSURL fileURLWithPath:strURL]];
    }else{
         player = [[MPMoviePlayerController alloc]initWithContentURL:[NSURL URLWithString:strURL]];
    }
    
   
    player.view.frame =CGRectMake(0, 0, 1024, 748);
    player.view.backgroundColor=[UIColor clearColor];
    //[player setControlStyle:MPMovieControlStyleFullscreen];
    
    
//   [[NSNotificationCenter defaultCenter] addObserver:self
//                                             selector:@selector(myMovieFinishedCallback:)
//                                                 name:MPMoviePlayerPlaybackDidFinishNotification
//                                               object:player];
    /*
     [[NSNotificationCenter defaultCenter] addObserver:self
     selector:@selector(myMoviePlaying2:)
     name:MPMovieMediaTypesAvailableNotification
     object:player];
     */
    /*
     MPMovieMediaTypesAvailableNotification
     视频开始播放 (载入完成)
     
     MPMoviePlayerNowPlayingMovieDidChangeNotification
     视频开播 (开始载入)
     */
    [self.view addSubview:player.view];
    [player play];
    
    
    UIButton *btnBack=[[UIButton alloc]initWithFrame:CGRectMake(5, 5, 42, 30)];
    [btnBack addTarget:self action:@selector(btnBackAction) forControlEvents:UIControlEventTouchUpInside];
    [btnBack setImage:[UIImage imageNamed:@"fanhui.png"] forState:UIControlStateNormal ];
    [self.view addSubview:btnBack];
    [btnBack release];
    
	// Do any additional setup after loading the view.
}

-(void)btnBackAction{
    [player pause];
    
    [self.navigationController popViewControllerAnimated:YES];
    
}
- (void)myMovieFinishedCallback:(NSNotification*)aNotification
{
    MPMoviePlayerController* theMovie=[aNotification object];
    [[NSNotificationCenter defaultCenter] removeObserver:self
                                                    name:MPMoviePlayerPlaybackDidFinishNotification
                                                  object:theMovie];
    // Release the movie instance created in playMovieAtURL
    // [theMovie release];
    
}
-(void)viewWillDisappear:(BOOL)animated{
    
    [super viewWillDisappear:YES];
    
    
}


- (void)viewDidUnload
{
    [super viewDidUnload];
    // Release any retained subviews of the main view.
}
-(void)dealloc{
    
    [player release];
    [strURL release];
    [super dealloc];
    
}
#if __IPHONE_OS_VERSION_MAX_ALLOWED >= __IPHONE_6_0

-(NSUInteger)supportedInterfaceOrientations
{
    return UIInterfaceOrientationMaskLandscape;
}

- (BOOL)shouldAutorotate {
    return YES;
}

#endif



// Override to allow orientations other than the default portrait orientation.
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation
{
    // Return YES for supported orientations
    return (interfaceOrientation == UIInterfaceOrientationLandscapeLeft  ||
            interfaceOrientation == UIInterfaceOrientationLandscapeRight);
    
}

@end
