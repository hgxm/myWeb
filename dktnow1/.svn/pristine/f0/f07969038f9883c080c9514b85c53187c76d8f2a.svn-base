<include file="../Public/header_main" />
<load file="__PUBLIC__/Css/Ilc/resource_index.css"/>

<script type="text/javascript">
    $(function(){

        // 默认获取第一级
        listChild($('input[name=d_id]').val());

        // 点击父级显示下级
        $(document).on('click', ".getChild", function() {
            listChild(0, $(this).parents('li').find('input').val(), $(this).parents('.sty_left').index());
        })

        $(document).on('click', '.data_check', function(){

            var obj = $('#'+$(this).attr('attr')+' :checkbox');

            var flag = $(this).prop('checked');

            obj.each(function(i){

                $(this).prop("checked", flag);

            })
        });

    })

    function listChild(did, tid = 0, position = 0) {

        if (position) {
            position = position - 3;
        }

        $(".sty_left").each(function(y) {
            if (y > position) {

                $(this).html('');
            }
        })
        $.post('__URL__/getChildPoints', 't_id='+tid+'&d_id='+did, function(json) {
           if (json) {

               var str = '<ul class="list_hea"><li><input class="data_check" type="checkbox" name="allcheck" id="check" attr="IlcTableList'+position+'" /><span class="data_id">知识点列表</span></li></ul><ul id="IlcTableList'+position+'" class="list_list list_hea">';

               for (var i = 0; i < json.length; i ++ ) {

                    str += '<li><input class="data_check" type="checkbox" name="key" value="'+json[i]['t_id']+'" /><span class="data_id"><a href="javascript:void(0);" class="getChild">'+json[i]['t_name']+'</a></span></li>';
               }

               str += '</ul>';

               $('.sty_left').eq(position).html(str);

               var listObj = {"data_check": "12%","data_id": "30%"};
               setWidth(listObj);

           }
        }, 'json')
    }

    function insert(d_id, id) {
        var keyValue;
        if (id) {
            keyValue = id;
        } else {
            keyValue = getSelectCheckboxValues();
        }
        if (!keyValue) {
            alert('请选择添加项！', 0);
            return false;
        }

        location.href =  URL+"/insert/d_id/"+d_id+"/id/"+keyValue;
    }

</script>
<h2 class="res study_add">知识点列表<a href="javascript:history.go(-1);">返回列表</a></h2>
<input type="hidden" name="d_id" value="{$d_id}" />
<a href="javascript:void(0);" class="stydy_return fl" onclick="insert({$d_id})">添加</a>
<div class="clear"></div>

<div class="sty_left">

</div>
<div class="sty_left">

</div>
<div class="sty_left">

</div>
