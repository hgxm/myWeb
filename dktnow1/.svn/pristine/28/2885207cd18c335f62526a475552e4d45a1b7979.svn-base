//
//  SaveView.m
//  ClassRoomTeacher
//
//  Created by apple  on 13-6-25.
//  Copyright (c) 2013年 apple . All rights reserved.
//

#import "SaveView.h"

@implementation SaveView
@synthesize delegate;
- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        
        UIView *blackView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 1024, 748)];
        blackView.backgroundColor = [UIColor blackColor];
        blackView.alpha = 0.5;
        [self addSubview:blackView];
        [blackView release];
        

        
        contentView = [[UIImageView alloc] initWithFrame:CGRectMake(1024/2-340, 130, 680, 385)];
        contentView.image = [UIImage imageNamed:@"cc保存板书.png"];
        contentView.userInteractionEnabled = YES;
        [self addSubview:contentView];
        [contentView release];
        
        UILabel *lblTitle = [[UILabel alloc] initWithFrame:CGRectMake(0, 30, 680, 30)];
        lblTitle.text = @"保存板书";
        lblTitle.font = [UIFont boldSystemFontOfSize:18];
        lblTitle.backgroundColor = [UIColor clearColor];
        lblTitle.textColor = [UIColor orangeColor];
        lblTitle.textAlignment = NSTextAlignmentCenter;
        [contentView addSubview:lblTitle];
        [lblTitle release];
        
        
        UIButton *btnclose  = [[UIButton alloc] initWithFrame:CGRectMake(30, 30, 55, 30)];
        [btnclose setBackgroundImage:[UIImage imageNamed:@"cc关闭按扭.png"] forState:UIControlStateNormal];
        [btnclose setTitle:@"关闭" forState:UIControlStateNormal];
        [btnclose addTarget:self action:@selector(btncloseAction) forControlEvents:UIControlEventTouchUpInside];
        [btnclose setTitleColor:[UIColor orangeColor] forState:UIControlStateNormal];
        [contentView addSubview:btnclose];
        [btnclose release];
        
        
        UIButton *btnSure  = [[UIButton alloc] initWithFrame:CGRectMake(590, 30, 55, 30)];
        [btnSure setBackgroundImage:[UIImage imageNamed:@"cc确定按钮.png"] forState:UIControlStateNormal];
        [btnSure addTarget:self action:@selector(btnSureAction) forControlEvents:UIControlEventTouchUpInside];
        [btnSure setTitle:@"确定" forState:UIControlStateNormal];
        [contentView addSubview:btnSure];
        [btnSure release];
        
        textField = [[UITextField alloc] initWithFrame:CGRectMake(35, 100, 460, 34)];
        textField.backgroundColor = [UIColor clearColor];
        textField.text = @"";
        textField.font = [UIFont systemFontOfSize:18];
        [contentView addSubview:textField];
        [textField release];
        
        lbl = [[UILabel alloc] initWithFrame:CGRectMake(510, 95, 130, 34)];
        lbl.text = @"输入新增板书名称";
        lbl.font = [UIFont boldSystemFontOfSize:15];
        lbl.textColor = [UIColor lightGrayColor];
        [contentView addSubview:lbl];
        [lbl release];
        
        
        for (int i=0; i<2; i++) {
            
            
            UIButton *btn = [[UIButton alloc] initWithFrame:CGRectMake(35+i*130, 160, 100, 20)];
            [btn setImage:[UIImage imageNamed:@"cc勾选1.png"] forState:UIControlStateNormal];
            btn.tag = i+10;
            btn.backgroundColor = [UIColor clearColor];
            [contentView addSubview:btn];
            [btn release];
            [btn addTarget:self action:@selector(btnSelect:) forControlEvents:UIControlEventTouchUpInside];
            btn.imageEdgeInsets = UIEdgeInsetsMake(0, -20, 0, 0);
            switch (i) {
                case 0:
                    [btn setTitle:@"新增板书" forState:UIControlStateNormal];
                    [btn setImage:[UIImage imageNamed:@"cc勾选2.png"] forState:UIControlStateNormal];

                    break;
                case 1:
                    [btn setTitle:@"替换板书" forState:UIControlStateNormal];
                    
                    break;
                    
                default:
                    break;
            }
            [btn setTitleColor:[UIColor colorWithRed:188.0/255 green:179.0/255 blue:164.0/255 alpha:1] forState:UIControlStateNormal];
            btn.titleLabel.font = [UIFont boldSystemFontOfSize:14];
            
        }
        select = -1;
        
        myTable = [[UITableView alloc] initWithFrame:CGRectMake(20, 190, 600, 160)];
        myTable.backgroundColor = [UIColor clearColor];
        myTable.separatorColor = [UIColor clearColor];
        myTable.delegate = self;
        myTable.dataSource = self;
        myTable.alpha = 0.5;
        myTable.userInteractionEnabled = NO;
        [myTable setShowsVerticalScrollIndicator:NO];
        [contentView addSubview:myTable];
        [myTable release];
    }
    return self;
}
-(void)flushMytabel:(NSMutableArray *)arrray{
    
    dataMuarr = [arrray mutableCopy];
    [myTable reloadData];
}
-(void)btnSelect:(UIButton *)btn{
    
    
    [btn setImage:[UIImage imageNamed:@"cc勾选2.png"] forState:UIControlStateNormal];

    if (btn.tag == 10) {
        
        myTable.userInteractionEnabled = NO;
        myTable.alpha = 0.5;
        lbl.text = @"输入新增板书名称";
        
        UIButton *preBtn =  (UIButton *)[contentView viewWithTag:11];
        [preBtn setImage:[UIImage imageNamed:@"cc勾选1.png"] forState:UIControlStateNormal];
        
    }else{
        
        myTable.userInteractionEnabled = YES;
        myTable.alpha = 1.0;
        lbl.text = @"输入替换板书名称";
        
        UIButton *preBtn =  (UIButton *)[contentView viewWithTag:10];
        [preBtn setImage:[UIImage imageNamed:@"cc勾选1.png"] forState:UIControlStateNormal];
    }
}

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    // Return the number of sections.
    
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    // Return the number of rows in the section.
    
    
    
    return [dataMuarr count];
    
    
    
}
- (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section{
    
    /*
     UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 613, 93)];
     view.backgroundColor = [UIColor colorWithRed:236.0/255 green:236.0/255 blue:236.0/255 alpha:1];
     
     UIImageView *view2 = [[UIImageView alloc]initWithFrame:CGRectMake(0, 0, 613, 73)];
     view2.image = [UIImage imageNamed:@"作业列表背景.png"];
     [view addSubview:view2];
     [view2 release];
     
     
     UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(20, 20, 613, 30)];
     label.text = @"练习一:洪秀全农民起义是在什么样的情况下产生的";
     label.backgroundColor = [UIColor clearColor];
     label.font = [UIFont boldSystemFontOfSize:16];
     [view addSubview:label];
     [label release];
     
     return view;
     */
    return nil;
}
- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
    
    return 0;
}
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    
    return 80;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    
    NSString *strCell = @"cell";
    NSMutableDictionary *muDict = [dataMuarr objectAtIndex:indexPath.row];
    
     BanshuListCell *cell = [tableView dequeueReusableCellWithIdentifier:strCell];
     if (cell == nil) {
         cell = [[BanshuListCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:strCell];
     
     }if (select==indexPath.row) {
         cell.accessoryType=UITableViewCellAccessoryCheckmark;
     }else{
         cell.accessoryType=UITableViewCellAccessoryNone;
     }
    [cell updateCell:muDict];
     cell.selectionStyle = UITableViewCellSelectionStyleNone;
     [cell changeUI:YES];
     return cell;
}


- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{
    
    select = indexPath.row;
    [myTable reloadData];
}




//关闭，确定
-(void)btncloseAction{
    
    [self removeFromSuperview];
}


-(void)btnSureAction{
    
    if ([textField.text isEqualToString:@""]) {
        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"提示" message:@"板书名称不能为空！" delegate:self cancelButtonTitle:@"确定" otherButtonTitles:nil, nil];
        [alert show];
        [alert release];
        
        
        return;
    }
    if (delegate&&[delegate respondsToSelector:@selector(sureSaveAction:cpaTitle:)]) {
        
        if (myTable.alpha == .5) {
            [delegate sureSaveAction:@"0" cpaTitle:textField.text];

        }else{
            if (select == -1) {
                UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"提示" message:@"请选择要替换的板书！" delegate:self cancelButtonTitle:@"确定" otherButtonTitles:nil, nil];
                [alert show];
                [alert release];
                
                return;
            }
            NSMutableDictionary *muDict = [dataMuarr objectAtIndex:select];
            [delegate sureSaveAction:[muDict objectForKey:@"cpa_id"] cpaTitle:textField.text];
        }
        
    }
}

-(void)dealloc{
    
    [dataMuarr release];
    [super dealloc];
}
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
    
    //[self removeFromSuperview];
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
