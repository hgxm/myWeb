<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <script type="text/javascript" src="./Js/jquery-1.9.1.js" ></script>
    <script type="text/javascript" src="./Js/public.js" ></script>
    <link href="./Css/public.css" type="text/css" rel="stylesheet">
    <link href="./Css/show.css" type="text/css" rel="stylesheet">
    <!--[if IE 6]>
    <script type="text/javascript" src="./Js/png.js" ></script>
    <script type="text/javascript">
        DD_belatedPNG.fix('#logo,.cShare,.cEdit,.cIn,.cClone,.cExport,.cDel,.fw_baoming_left,.fw_btn,.anli_ico_link,.anli_ico,.selected,.selected_green,.selected_gray,.to-left,.to-right,.current,.mt_tab li,.classhomework_top li,.choose_class,.current img,.res_click,.res_scan,.res_frame.png,#main_bg li img,.jCal .left,.jCal .right');
    </script>
    <![endif]-->
    <style>.current {background:#93E5BD;}</style>
    <title>大课堂互动教学</title>
    <script>
        <!--//

            // 导航动画效果
            $(function(){

                $('#header li a').wrapInner('<span class="out"></span>');

                $('#header li a').each(function() {
                    $('<span class="over">' + $(this).text() + '</span>').appendTo(this);
                });

                $('#header li a').hover(function() {
                    $('.out',this).stop().animate({'top':'67px'},200);
                    $('.over',this).stop().animate({'top':'0px'},200);

                }, function() {
                    $('.out',this).stop().animate({'top':'0px'},200);
                    $('.over',this).stop().animate({'top':'-67px'},200);
                });
                
                $('#header li a').click(function(){

                    // 选中菜单项的样式
                    $(this).addClass('on').parent().siblings().find('a').removeClass('on');

                    // 恢复动画
                    $('.out',this).css('top','0px');
                    $('.over',this).css('top','-67px');
                    $(this).parent().siblings().find('a').hover(function(){
                        $('.out',this).stop().animate({'top':'67px'},200);
                        $('.over',this).stop().animate({'top':'0px'},200);
                    }, function() {
                        $('.out',this).stop().animate({'top':'0px'},200);
                        $('.over',this).stop().animate({'top':'-67px'},200);
                    })
                    // 停止当前点击导航的动画效果
                    $(this).hover(function(){
                        $('.out',this).stop();
                        $('.over',this).stop();
                    },function(){
                        $('.out',this).stop();
                        $('.over',this).stop();
                    })
                }).eq(0).click();

            })
        //-->
    </script>
</head>
<body id="body">
    <div id="header">
        <div>
            <a href="javascript:void(0);" id="logo"></a>
            <ul class="nav">
                <li><a href="javascript:;">课程超市</a></li>
                <li><a href="javascript:;">我的空间</a></li>
                <li><a href="javascript:;">资源中心</a></li>
                <li><a href="javascript:;">应用中心</a></li>
            </ul>
            <a href="javascript:void(0);" class="download">iPhone客户端下载</a>
        </div>
    </div>
    
    <div class="warp">
    <div id="main">
        <div class="main_hea fl">
            <a href="javascript:history.go(-1)" class="back">返回</a>
            <a></a>
            <span></span>
            <a></a>
            <span>></span>
            <a class="clName"></a>
            <span>></span>
            <a class="hea_class"></a>
            <input type="hidden" name="ta_id" value="{$tache.ta_id}"/>
        </div>
        <div class="main_main">
            <div class="main_left">
                <div></div>
                <ul>
                    <li class="left_click homework"></li>
                    <li class="contact"></li>
                    <li class="text"></li>
                    <li class="marry"></li>
                    <li class="read"></li>
                    <li class="resource"></li>
                    <li class="leave"></li>
                    <li class="ideas"></li>
                    <li class="poll"></li>
                    <li class="reason"></li>
                    <li class="group"></li>
                </ul>
            </div>
            <div class="main_right">
                <div class="sTopicList">
                    <div class="resourceContent"></div>
                    <div class="res_left"></div>
                    <div class="res_right"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="clear"></div>
    <div class="foot_bot"></div>
    <div class="foot_top"></div>
    <div id="footer">
        <div class="nav back1"></div>
        Copyright &copy; 2007-2011 北京金商祺移动互联 All Rights Reserved.
    </div>
    <script>

    // 获取URL参数
    var complex = getParameter('act_id');
    // 作业
    var homework = [];
    // 练习
    var classroomHomework = [];
    // 文本
    var context = [];
    // 链接
    var lined = [];
    // 扩展阅读
    var read = [];
    var act_id = [[],[],[],[],[],[],[],[],[],[],[]];
    var act_type = '';
    if (complex != '') {
        complex = complex.split('|');
        var arr = [];
        for (var i=0; i<complex.length; i++) {
            arr = complex[i].split(':');
            switch (parseInt(arr[0])) {
                case 1:
                    homework.push(arr[arr.length-1]);
                    act_id[1].push(arr[1]);
                    break;
                case 2:
                    classroomHomework.push(arr[arr.length-1]);
                    act_id[2].push(arr[1]);
                    break;
                case 3:
                    context.push(arr[arr.length-1]);
                    act_id[3].push(arr[1]);
                    break;
                case 4:
                    lined.push(arr[arr.length-1]);
                    act_id[4].push(arr[1]);
                    break;
                case 5:
                    read.push(arr[arr.length-1]);
                    act_id[5].push(arr[1]);
                    break;
            }
            act_type += ',' + arr[0];
        }
        act_type = act_type + ',';
    }

    $(function(){

        // 如果没有内容就不显示左侧图标
        if (act_type == '') {
            $('.main_left ul').hide();
            $('.res_left').hide();
            $('.res_right').hide();
        }

        // 前端 左侧高度
        var t_height = document.body.clientWidth - 153;
        $('.main_left').css('height',t_height);

        var tArrow = $('.main_left').width();
        var tCenter = $('.right_center').width();
        $('.right_center li').css('width',tCenter+'px');

        // 隐藏没有的活动类型
        $('.main_left ul li').each(function (i) {
            if (act_type && act_type.indexOf(','+ (i+1) + ',') == -1) {
                $(this).remove();
            }
        })

        // 如果只有一个类型
        if ($('.main_left ul li').size() == 1) {
            $('.res_left').hide();
            $('.res_right').hide();
        }

        var tArrow = $('.main_left').width();
        var tCenter = $('.right_center').width();
        $('.right_center li').css('width',tCenter+'px');

        // 左侧伸缩按钮
        $('.main_left div').click(function(){
            if ($(this).hasClass('left_arrow')){
                $(this).removeClass("left_arrow");
                $('.main_left').width("15%");
                $('.main_left ul').show();
                $('.main_right').width('84%');
            } else {
                $(this).addClass("left_arrow");
                $('.main_left').width("0%");
                $('.main_left ul').hide();
                $('.main_right').width('95%');
            }
        })

        // 左侧样式点击
        $('.main_left li').click(function(){
            $(this).addClass('left_click').siblings().removeClass('left_click');

            // 作业
            if ($(this).hasClass('homework')) {
                if (homework) {
                    syncHomework(homework, 1);
                }

            // 练习
            } else if ($(this).hasClass('contact')) {
                if (classroomHomework) {
                    syncHomework(classroomHomework, 2);
                }

            // 文本
            } else if ($(this).hasClass('text')) {
                if (classroomHomework) {
                    syncHomework(classroomHomework, 3);
                }

            // 链接
            } else if ($(this).hasClass('linked')) {
                if (classroomHomework) {
                    syncHomework(classroomHomework, 4);
                }

            // 扩展阅读
            } else if ($(this).hasClass('read')) {
                if (classroomHomework) {
                    syncHomework(classroomHomework, 5);
                }
            } else {
                $('.resourceContent').html('');
            }

            $('.main_right > div').eq($(this).index()).show().siblings().hide();
        }).eq(0).click();

        var cl_id = getParameter("cl_id");
        var l_id = getParameter("l_id");
        var co_id = getParameter("co_id");
        var ta_id = getParameter("ta_id");

        setLesson(l_id);
        setClasshour(cl_id);
        setTache(ta_id);

        // 左边点击
        $(document).on('click', '.res_left', function () {
            changeClick(0);
        })

        // 右边点击
        $(document).on('click', '.res_right', function () {
            changeClick(1);
        })

    })

    function changeClick(num) {

        var index = $('.main_left li.left_click').index();
        var count = $('.main_left li').size() - 1;

        if (num == 1) {
            index = index == count ? 0 : index + 1;
        } else {
            index = index == 0 ? count : index - 1;
        }

        $('.main_left li').eq(index).click();
    }

    // 获取课时
    function setClasshour(cl_id) {

        $.getJSON("./Data/classhour.txt", function(json) {
            $.each(json, function(i, data){
                if (data['cl_id'] == cl_id) {
                    $('.main_hea a.clName').html(data['cl_title']);
                }
            })
        });
    }

    // 获取课文
    function setLesson(l_id) {

        $.getJSON("./Data/lesson.txt", function(json) {
            var str = '';
            var pId = 0;
            $.each(json, function(i, data){
                if (data['id'] == l_id) {
                    str = data['name'];
                    pId = data['pId'];
                }
            })

            $.each(json, function(i, data){
                if (data['id'] == pId) {
                    str = data['name'] + '>' + str;
                }
            })

            $('.main_hea a').eq(2).html(str);
        })
    }

    // 获取环节
    function setTache(ta_id) {
        $.getJSON("./Data/tache.txt", function (json) {
            $.each(json, function (i, data) {
                if (data['ta_id'] == ta_id) {
                    $('.main_hea a.hea_class').html(data['ta_title']);
                }
            })
        })
    }

    // 异步加载作业显示到页面上
    function syncHomework(data, num) {

        var html = '', syncCount = 1111, tmp = '', temp = '';

        // 活动ID
        if (act_id[num]) {
            var id = act_id[num].join(',');
            id = id != '' ? ',' + id + ',' : '';
        }

        if (num == 1 || num == 2) {
            $.post('./Data/topic.txt', '', function (json) {

                if (json) {
                    for (var ii=0; ii<data.length; ii++) {
                        temp = ',' + data[ii] + ',';
                        html += '<h3 class="TopicTitle"></h3>'
                        for (var i=0; i< json.length; i++) {
                            tmp = ',' + json[i]['to_id'] + ',';
                            if (temp.indexOf(tmp) == -1) {
                                continue;
                            }
                            html += '<div class="resour_online" rel="' + json[i]['to_id'] + '" attr="' + json[i]['to_type'] + '">'
                                    +  '<i>' + getIdByTopicType(json[i]['to_type']) + '</i>'
                                    +  '<div class="online_cursor">'
                                    +  '' + json[i]['to_title'] + ''
                                    + '<div>';
                            if (json[i]['to_type'] == 1) {
                                html += syncSingle(syncCount, json[i]['to_option'], json[i]['to_answer']);
                            } else if (json[i]['to_type'] == 2) {
                                html += syncMulti(json[i]['to_option'], json[i]['to_answer']);
                            } else if (json[i]['to_type'] == 3) {
                                html += syncFill(json[i]['to_option'], json[i]['to_answer']);
                            } else if (json[i]['to_type'] == 4) {
                                html += syncJudge(syncCount, json[i]['to_option'], json[i]['to_answer']);
                            } else {
                                html += '<label style="cursor: pointer;">' + syncShort(json[i]['to_answer']) + '</label>';
                            }
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';

                            syncCount++;
                        }

                    }
                    $('.resourceContent').html(html);

                    $.post('./Data/activity.txt', '', function (json) {
                        if (json) {
                            var TopicTitle = [];
                            for (var j=0,len=json.length; j<len; j++) {
                                if (id.indexOf(',' + json[j]['act_id'] + ',') !== -1) {
                                    TopicTitle.push(json[j]['act_title']);
                                }
                            }
                            if(TopicTitle && $('.TopicTitle')) {
                                $('.TopicTitle').each(function (i) {
                                    $(this).text(TopicTitle[i]);
                                })
                            }
                        }
                    }, 'json');

                }

            }, 'json');

        } else if (num == 3) {
            $.post('./Data/activity.txt', '', function (json) {
                if (json) {
                    for (var i = 0, len = json.length; i < len; i++) {
                        if (id.indexOf(',' + json[i]['act_id'] + ',') != -1) {
                            html+= '<h3 class="TopicTitle">' + json[i]['act_title'] + '</h3>'
                                +  '<div class="resour_online">'
                                +  '<i>' + json[i]['act_note'] + '</i>'
                                +  '<div class="online_cursor">'
                                +  '<div></div></div></div>';

                        }
                    }
                }
                $('.resourceContent').html(html);
            }, 'json')
        } else if (num == 4 || num == 5) {
            $('.resourceContent').html('');
        }

    }

    // 处理题型为3的json字符串
    function procJsonCode(jsonCode) {

        var str = eval('(' + jsonCode + ')');
        return str.join(':');
    }

    // 单选题
    function syncSingle(i, num, answer) {

        var num = num.split(',');
        var html = '';
        var answer = eval('(' + answer + ')');
        for (var j = 0; j < num.length; j++) {
            if (j == parseInt(answer)) {
                html += '<input type="radio" name="single' + i + '" value="0" checked><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
            } else {
                html += '<input type="radio" name="single' + i + '" value="0"><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
            }
        }
        return html;
    }

    // 多选题
    function syncMulti(num, answer) {

        var num = num.split(',');
        var answer = eval('(' + answer + ')');
        var answer1 = answer[0].split(',');
        var html = '';
        for (var j = 0; j < num.length; j++) {
            tmp = syncArray(j, answer1);
            if (tmp) {
                html += tmp;
            } else {
                html += '<input type="checkbox" name="multiple" value="0"><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
            }
        }
        return html;
    }

    function syncArray(j, answer) {
        html = '';
        for (var jj = 0; jj < answer.length; jj++) {
            if (answer[jj] == j) {
                html += '<input type="checkbox" name="multiple" value="0" checked><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
            }
        }
        return html;
    }

    // 填空题
    function syncFill(num, answer) {
        var obj = eval('(' + answer + ')')
        var num = num.split(',');
        var html = '';
        for (var i = 0; i < num.length; i++) {
            html += '<li class="noline"><label style="cursor: pointer;">' + (i + 1) + '、' + obj[i] + '</label></li>';
        }
        return html;
    }


    // 判断题
    function syncJudge(i,num, answer) {
        var answer = eval('(' + answer + ')');
        answer = parseInt(answer);
        var html = '';
        html += '<input type="radio" name="judge' + i + '" ' + ((answer == 0) ? 'checked' : '') + '><label attr="1" style="cursor: pointer;" class="option"><img height="20" width="20" border="0" src="./Images/ok.jpg"></label>';
        html += '<input type="radio" name="judge' + i + '" ' + ((answer == 1) ? 'checked' : '') + '><label attr="2" style="cursor: pointer;" class="option"><img height="20" width="20" border="0" src="./Images/err.jpg"></label>'
        return html;
    }
    function infor(i) {
        var arr = new Array();
        arr[0] = 'A';
        arr[1] = 'B';
        arr[2] = 'C';
        arr[3] = 'D';
        arr[4] = 'E';
        arr[5] = 'F';
        return arr[i % 6];
    }

    // 已经题型id获取题型汉字信息
    function getIdByTopicType(id) {

        var word = '';

        switch (parseInt(id)) {
            case 1:
                word = '单项选择题';
                break;
            case 2:
                word = '多项选择题';
                break;
            case 3:
                word = '填空主观题';
                break;
            case 4:
                word = '判断题';
                break;
            case 5:
                word = '简答题';
                break;
        }

        return word;
    }

    // 获取url传参
    function getParameter(param) {
        var query = window.location.search;
        query = '&' + query.slice(1);
        param = '&' + param + '=';
        var iLen = param.length;
        var iStart = query.indexOf(param);
        if (iStart == -1) {
            return "";
        }
        iStart += iLen;
        var iEnd = query.indexOf("&", iStart);
        if (iEnd == -1) {
            return query.substring(iStart);
        }
        return query.substring(iStart, iEnd);
    }

    // 简答
    function syncShort(answer) {
        var answer = eval('(' + answer + ')');
        return answer;
    }
    </script>
</body>
</html>