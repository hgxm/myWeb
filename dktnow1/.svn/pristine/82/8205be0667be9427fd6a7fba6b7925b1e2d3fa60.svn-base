//
//  TiankongView.m
//  BigClassRoom
//
//  Created by apple  on 13-3-12.
//
//

#import "TiankongView.h"
#import <QuartzCore/QuartzCore.h>
@implementation TiankongView
@synthesize isShowRightAnswer;
- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        isShowRightAnswer = 1;
        
    }
    return self;
}
-(void)changUI:(NSMutableDictionary *)dict daan:(NSMutableDictionary *)answerDict index:(int)i{
    
    
    muAnswerDict = answerDict;
    to_id = [[dict objectForKey:@"to_id"] intValue];
    

    [self flushSelfView:dict];
    
}



-(void)flushSelfView:(NSMutableDictionary *)dict{

    
        
    NSString *to_option=[dict objectForKey:@"to_option"];
    NSArray *arr=[to_option componentsSeparatedByString:@","];
    count = [arr count];
    
    for (int i=0; i<[arr count]; i++) {
        
        UILabel *lbl=[[UILabel alloc]initWithFrame:CGRectMake(50, 50*i+50, 30, 30)];
        lbl.backgroundColor=[UIColor clearColor];
        lbl.text=[NSString stringWithFormat:@"(%d)",i+1];
        lbl.textColor=[UIColor colorWithRed:71.0/255 green:92.0/255 blue:109.0/255 alpha:1];
        lbl.textAlignment=NSTextAlignmentLeft;
        [self addSubview:lbl];
        [lbl release];
        
        
        UITextField *textField=[[UITextField alloc]initWithFrame:CGRectMake(80,50*i+50, 330, 30)];
        textField.text=@"";
        textField.tag=i+10;
        textField.delegate=self;
        textField.layer.borderWidth=1;
        textField.layer.borderColor=MYCOLOR.CGColor;
        [self addSubview:textField];
        [textField release];
        
    }

    NSArray *answer = [[dict objectForKey:@"to_answer"] JSONValue];
    
    
    UILabel *answerLbl = [[UILabel alloc]initWithFrame:CGRectMake(50, 50*[arr count]+50, 500, 130)];
    answerLbl.backgroundColor = [UIColor clearColor];
    answerLbl.numberOfLines = 0;
    answerLbl.hidden = isShowRightAnswer;
    answerLbl.text = [NSString stringWithFormat:@"正确答案:\t\t%@",[ToolClass getKong:answer]];
    answerLbl.font = [UIFont boldSystemFontOfSize:20];
    answerLbl.textColor = MYCOLOR;
    [self addSubview:answerLbl];
    [answerLbl release];

       
    if ([muAnswerDict objectForKey:[NSString stringWithFormat:@"%d",to_id]]) {
    
        NSArray *strAnwers = [[muAnswerDict objectForKey:[NSString stringWithFormat:@"%d",to_id]] JSONValue];
        NSLog(@"strasfsdf sd s %@",strAnwers);
        for (int i=0; i<[strAnwers count]; i++) {
            
            ((UITextField *)[self viewWithTag:i+10]).text = [strAnwers objectAtIndex:i];
        }
    }
    
}

- (BOOL)textFieldShouldEndEditing:(UITextField *)textField{
    
    
    NSMutableArray *muArr = [[NSMutableArray alloc] init];
    for (int i=0; i<count; i++) {
        UITextField *textFild = (UITextField *)[self viewWithTag:i+10];
        [muArr addObject:textFild.text];
    }
    
    [muAnswerDict setObject:[muArr JSONFragment] forKey:[NSString stringWithFormat:@"%d",to_id]];
    [muArr release];
    muArr = nil;
    
    
    NSLog(@"做了作业 is %@",muAnswerDict);

    
    return YES;
}
-(void)dealloc{
    
    [super dealloc];
}
//- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField{
//    NSString *str=[NSString stringWithFormat:@"%d",self.tag];
//    [[NSNotificationCenter defaultCenter]postNotificationName:@"changeTableview" object:str];
//    return YES;
//}
//- (BOOL)textFieldShouldEndEditing:(UITextField *)textField{
//    
//    NSMutableDictionary *muDict2=[arrAnswer objectAtIndex:textField.tag-10];
//    
//    [muDict2 setObject:textField.text forKey:@"answer"];
//    
//
//    
//    return YES;
//}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
