<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/jquery-ui.css"/>
<load href="/Public/Js/Home/jquery-ui.js"/>
<load href="__PUBLIC__/Css/Ilc/lead.css"/>
<script>
$(function(){
    //表格排列
    var dateWidth = {'data_check':'2%','data_id':'8%','data_name':'27%','data_column':'30%','data_tran':'12%','data_state':'8%','data_upload':'8%','data_hand':'16%'};
    setWidth(dateWidth);

    //checkbox 按钮
    $(document).on('click','input[name=allcheck]',function(){
        if($(this).is(':checked')){
            $('.data_main .data_check').prop('checked',true)
        }else{
            $('.data_main .data_check').prop('checked',false)
        }
    })

    //禁用，发布等 按钮的 滑入滑利效果
    $('.handle_operate li').hover(function(){
        var oldName = $(this).attr('class');
        $(this).removeClass(oldName).addClass(oldName+'_on');
    },function(){
        var oldName = $(this).attr('class');
        var oLen = oldName.length - 3;
        var newName = oldName.substring(0,oLen);
        //.str.slice(0,-3);
        $(this).removeClass(oldName).addClass(newName);
    })

    // 新增按钮点击
    $('.tools .add').click(function(){
        $(".model_incre").dialog("open");
    })

    // 新增弹框
    $(".model_incre").dialog({
        draggable: true,        // 是否允许拖动,默认为 true
        resizable: true,        // 是否可以调整对话框的大小,默认为 true
        autoOpen: false,        // 初始化之后,是否立即显示对话框,默认为 true
        position :'center',       // 用来设置对话框的位置
        stack : true,       // 对话框是否叠在其他对话框之上。默认为 true
        modal: true,       // 是否模式对话框,默认为 false(模式窗口打开后，页面其他元素将不能点击，直到关闭模式窗口)
        bgiframe: true,         // 在IE6下,让后面遮罩层盖住select
        width: '500',
        height: 'auto',

        show: {     // 对话框打开效果
            effect: "blind",
            duration: 400
        },
        hide: {     // //对话框关闭效果
            effect: "explode",
            duration: 400
        },
        overlay: {
            backgroundColor: '#000',
            opacity: 0.5
        },
        buttons: {
            确定: function() {
                var t_mod,t_img,t_name;
                var t_true = true;
                var v_name = $('.model_incre .model_name').val();
                var v_text = $('.model_incre textarea').val();
                var v_size = $('.data_main li').size() + 1;
                //判断名称
                var t_val = v_name.replace(/[ ]/g,'');

                if (t_val == 0) {
                    $('.model_incre .model_name').next().text('用户名不能为空').addClass('cor_red');
                    t_true = false;
                }

                if (t_val.length > 6) {
                    $('.model_incre .model_name').next().text('用户名太长').addClass('cor_red');
                    t_true = false;
                }

                //判断说明字符
                var t_tex = v_text.replace(/[ ]/g,'');

                if (t_tex.length > 200){
                    showMessage('说明内容不能超过200字符');
                    t_true = false;
                }

                //判断类型选择
                $('.model_incre .mod_type input').each(function(){
                    if ($(this).is(':checked')) {
                        $(this).parent().addClass('new_tye');
                    } else {
                        $(this).parent().removeClass('new_tye');
                    }
                })

                var t_tye = $('.model_incre .mod_type .new_tye').size();
                if (t_tye == 0) {
                    showMessage('请选择相应的类型');
                    t_true = false;
                }

                //状态判断
                $('.model_incre input[name=check_open]').each(function(){
                    if ($(this).is(':checked')) {
                        $(this).parent().addClass('new_open');
                    } else {
                        $(this).parent().removeClass('new_open');
                    }
                })

                if ($('.model_incre .new_open').text() == '关闭') {
                    t_mod = "启用";
                    t_img = "<img src='__APPURL__/Public/Images/Ilc/jy_status.gif'/>";
                    t_name = "dal_res";
                } else {
                    t_mod = "禁用";
                    t_img = "<img src='__APPURL__/Public/Images/Ilc/qy_status.png'/>";
                    t_name = "";
                }

                if(t_true == true){
                    if ($('.data_main .on').size() == 0 ) {
                         $('.data_main').append("<li class="+t_name+"><input type='checkbox' name='' class='data_check'/><span class='data_id'>"+v_size+"</span><span class='data_name' title="+v_name+">"+v_name+"</span><span class='data_column' title="+t_tex+">"+t_tex+"</span><span class='data_tran'>"+t_img+"</span><span class='data_state'>"+t_mod+"</span><span class='data_upload'>编辑</span></li>");
                    
                    } else {
                        $('.data_main .on').children('.data_name').text(v_name);
                        $('.data_main .on').children('.data_column').text(t_tex);
                        $('.data_main .on').children('.data_tran').html(t_img);
                        $('.data_main .on').children('.data_state').text(t_mod);
                        $('.data_main .on').removeClass('on');
                    }
                    setWidth(dateWidth);
                    $(this).dialog('close');
                }
            },
            取消: function() {
                $(this).dialog('close');
            }
        }
    })

    //cheaked选中事件
    $(document).on('change','.data_main .data_check',function(){
        if ($(this).is(":checked")) {
            $(this).parent().addClass('del_on');
        } else {
            $(this).parent().removeClass('del_on');
        }
    })

    //删除按钮 点击
    $('.tools .del').click(function(){
        if ($('.data_main .del_on').size() == 0)
        {
            showMessage('请选择删除项');
            return false;
        } else {
            if (confirm('你确定要删除吗')){
                $('.data_main .del_on').remove();
            } else {
                return false;
            }
        }
    })

    //禁用按钮点击
    $('.tools .forbidden').click(function(){
        var t_true = true;
        if ($('.data_main .del_on').size() == 0) {
            showMessage('请选择禁用项');
            return false;
        } else {
            t_true = true;
        }

        $('.data_main .del_on').each(function(){
            if ($(this).hasClass('dal_res')) {
                t_true = false;
            } else {
                t_true = true;
            }
        })

        if (t_true == true) {
            if (confirm('你确定要禁用吗')) {
                $('.data_main .del_on').children('.data_tran').html("<img src='__APPURL__/Public/Images/Ilc/jy_status.gif'>");
                $('.data_main .del_on').children('.data_state').text('启用');
                $('.data_main .del_on').addClass('dal_res');
            } else {
                return false;
            }
        }
    })

    // 启用按钮点击
    $('.tools .resume').click(function(){
        var t_true = true;
        if ($('.data_main .del_on').size() == 0) {
            showMessage('请选择启用项');
            t_true = false;
            return false;
        } else {
            t_true = true;
        }

        if ($('.data_main .del_on').hasClass('dal_res')) {
            t_true = true;
        } else {
            t_true = false;
            return false;
        }

        if (t_true == true) {
            if (confirm('你确定要启用吗')) {
                $('.data_main .del_on').children('.data_tran').html("<img src='__APPURL__/Public/Images/Ilc/qy_status.png'/>");
                $('.data_main .del_on').removeClass('dal_res');
                $('.data_main .del_on').children('.data_state').text('禁用');
            } else {
                return false;
            }
        }
    })

    //操作 禁用，启用点击
    $(document).on('click','.data_main .data_state',function(){
        if ($(this).parent().hasClass('dal_res')) {
            $(this).text('禁用').siblings('.data_tran').html("<img src='__APPURL__/Public/Images/Ilc/qy_status.png'/>");
            $(this).parent().removeClass('dal_res');
        } else {
            $(this).text('启用').siblings('.data_tran').html("<img src='__APPURL__/Public/Images/Ilc/jy_status.gif'>");
            $(this).parent().addClass('dal_res');
        }
    })

    //操作 编辑 点击
    $(document).on('click','.data_upload',function(){
        var t_new = '';
        $(this).parent().addClass('on').siblings().removeClass('on');
        $('.model_incre .model_name').val($(this).siblings('.data_name').text());
        $('.model_incre textarea').val($(this).siblings('.data_column').text());
        var t_tex = $(this).siblings('.data_state').text();
        if (t_tex == "禁用") {
            t_new = "关闭"
        } else {
            t_new = "打开"
        }
        $('.mod_open span').each(function(){
            //alert($(this).text())
            if($(this).text() == t_new) {
                $('.mod_open div').html("<span><input type='radio' name='check_open' />打开</span><span><input type='radio' name='check_open' checked=''/>关闭</span>")
                return false;
            } else { 
                $('.mod_open div').html("<span><input type='radio' name='check_open' checked=''/>打开</span><span><input type='radio' name='check_open'/>关闭</span>")
                return false;
            }
        })
        $(".model_incre").dialog("open");
    })

    //列表按钮选择

    //新增弹窗 名称 判断  blur
    $('.model_incre .model_name').blur(function(){
        var t_val = $(this).val().replace(/[ ]/g,'')
        if (t_val.length > 6) {
            $(this).next().text('名称不能超过6个字符').addClass('cor_red');
        } else {
            $(this).next().text('');
        }
    })

    //新增弹窗 名称 判断  focus
    $('.model_incre .model_name').focus(function(){
        $(this).next().text('请输入名称').removeClass('cor_red');
    })

    //编辑弹窗 名称 判断  blur
    $('.model_newly .model_name').blur(function(){
        var t_val = $(this).val().replace(/[ ]/g,'')
        if (t_val.length > 6) {
            $(this).next().text('名称不能超过6个字符').addClass('cor_red');
        } else {
            $(this).next().text('');
        }
    })

    //编辑弹窗 名称 判断  focus
    $('.model_newly .model_name').focus(function(){
        $(this).next().text('请输入名称').removeClass('cor_red');
    })

    //弹窗 属性值 选中和未选中
    $(document).on('change','.model_cor div input',function(){
        if ($(this).is(':checked')) {
            $(this).next().addClass('cor_pitch');
        } else {
            $(this).next().removeClass('cor_pitch');
        }
    })

    //弹窗 说明 判断数字
    $('.model_cor textarea').blur(function(){
        var t_val = $(this).val().replace(/[ ]g/,'');
        if (t_val.length > 200){
            showMessage('说明内容不能超过200个字符');
        }
    })

    $('.colu_arrow').addClass($('.colu_carte li.car_click').attr('attr'));
})
</script>
<div class='warp'>
<include file="Public:left"/>
<div class="colu_right">
    <ul class="colu_carte">
        <volist name="secondList" id="selist">
            <li attr="{$selist['sn_name']}" <eq name="selist.sn_name" value="ResourceCategory">class="car_click"</eq>><a href="__APPURL__{$selist['sn_url']}">{$selist['sn_title']}</a></li>
        </volist>
    </ul>
    <div class="colu_arrow sch_cst">
        <image src="__APPURL__/Public/Images/Ilc/resource_arrow.png"/>
    </div>
    <div class="colu_main lead_center">
        <div class="model_search">
            <input type="text" name="" value=""/>
            <a class="search">搜索</a>
        </div>
        <div class="tools fl">
            <span class="add" attr="1"><i></i>新增</span>
            <span class="del"><i></i>删除</span>
            <!--span class="forbidden"><i></i>禁用</span>
            <span class="resume"><i></i>启用</span-->
        </div>
        <ul class="handle_data data_hea">
            <li>
                <input type="checkbox" name="allcheck" class="data_check"/>
                <span class="data_id">编号</span>
                <span class="data_name">名称</span>
                <span class="data_column">说明</span>
                <span class="data_tran">状态</span>
                <span class="data_hand">操作</span>
            </li>
        </ul>
        <ul class="handle_data data_main">
            <li>
                <input type="checkbox" name="" class="data_check"/>
                <span class="data_id">1</span>
                <span class="data_name" title='鲁迅小说全集'>鲁迅小说全集</span>
                <span class="data_column" title='多媒体栏目'>多媒体栏目</span>
                <span class="data_tran">
                    <img src="__APPURL__/Public/Images/Ilc/qy_status.png"/>
                </span>
                <!--span class="data_state">禁用</span-->
                <span class="data_upload">编辑</span>
                <span class="sub_category">子栏目</span>
            </li>
        </ul>
    </div>
</div>
<!--弹窗-->
<div class="model_cor model_incre" title="栏目管理">
    <ul>
        <li>
            <label>栏目名称：</label>
            <input type="text" name="" value="" class="model_name"/>
            <p></p>
        </li>
        <li>
            <label>说明：</label>
            <textarea name="" placeholder="内容不能超过200个字符"></textarea>
        </li>
        <li class="mod_type">
            <label>模型：</label>
            <div>
                <span><input type="checkbox" name=""/>宽</span>
                <span><input type="checkbox" name=""/>高</span>
            </div>
        </li>
        <li>
            <label>是否显示：</label>
            <div>
                <span><input type="radio" name="check_no" checked=""/>是</span>
                <span><input type="radio" name="check_no"/>否</span>
            </div>
        </li>
        <li>
            <label>连接：</label>
            <input type='file' name='' class="mod_file"/>
        </li>
        <li>
            <label>是否审核：</label>
            <div>
                <span><input type="radio" name="check_sit" checked=""/>是</span>
                <span><input type="radio" name="check_sit"/>否</span>
            </div>
        </li>
        <li class="mod_open">
            <label>当前状态：</label>
            <div>
                <span><input type="radio" name="check_open" checked=""/>打开</span>
                <span><input type="radio" name="check_open"/>关闭</span>
            </div>
        </li>
    </ul>
</div>
</div>
<include file="Public:footer"/>