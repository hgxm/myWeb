<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/course.css"/>

    <script type="text/javascript">
    <!--
        $(function() {

            // 班级切换
            $('.class_tab li').click(function(){
                $(this).addClass('on').siblings().removeClass('on');

                // 课程列表
                courseList();

                // 作业列表
                homeworkList();

            }).eq(0).click();

            // 课程切换
            $(document).on('click', '.course_tab li', function(){
                $(this).addClass('on').siblings().removeClass('on');
                homeworkList();
            })

        })

        function courseList() {

            var c_id = $('.class_tab li.on').attr('attr');
            var type = $('.class_tab li.on').attr('rel');

            if (type != 'c_id') {
                $('.course_tab').html('<li class="on" attr="0">全部</li>');
                return false;
            }

            $.post('__APPURL__/Homework/courseList', 'id='+c_id, function(json){

                var str = '<li class="on" attr="0">全部</li>';

                if (json) {
                    for (var i = 0; i < json.length; i ++) {
                        str += '<li attr="'+json[i]['subject_id']+'">'+json[i]['subject_name']+'</li>';
                    }
                }

                $('.course_tab').html(str);
            }, 'json');
        }

        function homeworkList(p) {

            p = p ? p : 1;

            // 条件变量
            var parm = '';

            parm += 'act_type=2&p='+p;

            // 获取班级或群组ID
            if ($('.class_tab li.on').attr('attr') != 0) {
                parm += '&'+$('.class_tab li.on').attr('rel')+'='+$('.class_tab li.on').attr('attr');
            }

            // 获取课程ID
            if ($('.course_tab li.on').attr('attr') != 0) {
                parm += '&ap_course='+$('.course_tab li.on').attr('attr');
            }

            $.post('__APPURL__/Homework/lists', parm, function(json){

                var list = '';

                if (json.list) {

                    for (var i = 0; i < json.list.length; i ++) {
                        list += '<li class="do"><span class="item"></span><div><p class="hw_name">'+(i+1)+'.'+json.list[i]['act_title']+'</p><span class="btns bt1" onclick="dohomework('+json.list[i]['ap_id']+', '+json.list[i]['ad_id']+')">做练习</span><p class="bol"><span class="cname">';

                        if (json.list[i]['subject_name'] != null) {
                            list += json.list[i]['subject_name'];
                        } else {
                            list += '自定义';
                        }

                        list += '</span><span class="tname">'+json.list[i]['a_nickname']+'</span><span class="ddate">属于：'+json.list[i]['c_name']+json.list[i]['cro_name']+'</span></p><p class="bor"><span class="pdate">发布时间：'+json.list[i]['ap_created']+'</span><span class="ddate">截止时间：'+json.list[i]['ap_complete_time']+'</span></p></div></li>';
                    }

                }

                $('.listbox ul').html(list);

                if (json.page == undefined) {
                    $('.page').html('');
                } else {
                    $('.page').html(json.page);
                }



            }, 'json');
        }

        function getList(p) {
            homeworkList(p);
        }

        function dohomework(ap_id, ad_id) {

            if (ad_id == undefined) {
                ad_id = 0;
            }

            location.href="__APPURL__/ActivityData/doActivity/ap_id/"+ap_id+"/ad_id/"+ad_id;
        }
    //-->
    </script>

    <div class="warp">
        <include file="Public:leftSider"/>
        <div class="s_hwList">
            <p class="title">练习</p>
            <div class="class_list">
                <label>班级/群组</label>
                <ul class="class_tab">
                    <li attr="0" class="on">全部</li>
                    <volist name="class" id="class">
                        <li attr="{$class.c_id}" rel="c_id">{$class.c_name}</li>
                    </volist>

                    <volist name="crowd" id="crowd">
                        <li attr="{$crowd.cro_id}" rel="cro_id">{$crowd.cro_title}</li>
                    </volist>

                </ul>
            </div>
            <div class="course_list">
                <label>课程</label>
                <ul class="course_tab">

                    <li class="on" attr="0">全部</li>
                    <volist name="course" id="course">
                        <li attr="{$course.subject_id}">{$course.subject_name}</li>
                    </volist>

                </ul>
            </div>
            <div class="hw_list">
                <div class="listbox">
                    <ul>

                    </ul>
                    <div class="page">

                    </div>
                </div>


            </div>
        </div>
        <div class="clear"></div>
    </div>
<include file="Public:footer"/>