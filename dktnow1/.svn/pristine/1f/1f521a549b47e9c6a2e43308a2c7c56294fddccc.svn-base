//
//  ZhuxingView.m
//  JiChang
//
//  Created by apple  on 13-7-4.
//
//

#import "ZhuxingView.h"

@implementation ZhuxingView

-(void)clearScrollView{
    
    for (UIView *v in [scroll subviews]) {
        [v removeFromSuperview];
    }
}
-(void)changUI:(int)total data:(NSMutableDictionary *)muDict{
    
    
    count = total;
    
    NSMutableArray *allValues = (NSMutableArray *)[muDict allValues];

    NSSortDescriptor *sorter = [[NSSortDescriptor alloc] initWithKey:@"num" ascending:YES];
    NSArray *sortDescriptors = [[NSArray alloc] initWithObjects:&sorter count:1];
    allValues = (NSMutableArray *)[allValues sortedArrayUsingDescriptors:sortDescriptors];
    
    
    [sorter release];
    
    
    for (int i=0; i<[allValues count]; i++) {
        NSMutableDictionary *muDict = [allValues objectAtIndex:i];
        [muDict setObject:[NSString stringWithFormat:@"%f",self.frame.size.height-30] forKey:@"height"];
        float height = [[muDict objectForKey:@"peoples"] intValue]*1.0/count*(self.frame.size.height - 30);
        [muDict setObject:[NSString stringWithFormat:@"%f",height] forKey:@"height2"];
    }

    
        
    for (int i = 0; i < [allValues count]; i++) {
        
        NSMutableDictionary *tempDict=[allValues objectAtIndex:i];

        CGFloat fy=(self.frame.size.height - 20)-[[tempDict objectForKey:@"height"] floatValue];
        
        histogramView *hisView=[[histogramView alloc]initWithFrame:CGRectMake(i*45, fy, 30, [[tempDict objectForKey:@"height"] floatValue])];
        hisView.count=[tempDict objectForKey:@"height2"];
        hisView.backgroundColor=[UIColor whiteColor];
        [scroll addSubview:hisView];
        [hisView release];
        
        UILabel *lbl = [[UILabel alloc] initWithFrame:CGRectMake(i*45, self.frame.size.height - 20, 30, 20)];
        lbl.text= [NSString stringWithFormat:@"%@",[tempDict objectForKey:@"num"]];
        lbl.backgroundColor =[UIColor clearColor];
        lbl.font = [UIFont systemFontOfSize:12];
        lbl.textAlignment = NSTextAlignmentCenter;
        lbl.textColor =[ UIColor blackColor];
        [scroll addSubview:lbl];
    }
    
    [scroll setContentSize:CGSizeMake([allValues count]*45, self.frame.size.height)];
    
    
}
- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        
        
      
        scroll = [[UIScrollView alloc] initWithFrame:CGRectMake(10, 0, 620, self.frame.size.height)];
        scroll.backgroundColor = [UIColor clearColor];
        [scroll setShowsHorizontalScrollIndicator:NO];
        [self addSubview:scroll];
        [scroll release];
        
        
       
    }
    return self;
}

/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
