//
//  CaoGaoView.m
//  BigClassRoom
//
//  Created by apple  on 13-1-10.
//
//

#import "CaoGaoView.h"

@implementation CaoGaoView

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code

        
        UIImageView *headImageView=[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, 914, 514)];
        headImageView.image=[UIImage imageNamed:@"dt答题板.png"];
        headImageView.userInteractionEnabled=YES;
        [self addSubview:headImageView];
        [headImageView release];
        
        UIPanGestureRecognizer *panGestureCaogao = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(panPieceCaogao:)];
        [panGestureCaogao setMaximumNumberOfTouches:2];
        [headImageView addGestureRecognizer:panGestureCaogao];
        [panGestureCaogao release];
        
        UILabel *biaotiLabel=[[UILabel alloc]initWithFrame:CGRectMake(20, 10, 504, 38)];
        biaotiLabel.text=@"草稿";
        biaotiLabel.textColor=MYCOLOR;
        biaotiLabel.font=[UIFont boldSystemFontOfSize:17];
        biaotiLabel.backgroundColor=[UIColor clearColor];
        biaotiLabel.textAlignment=NSTextAlignmentLeft;
        [self addSubview:biaotiLabel];
        [biaotiLabel release];
        
//        UIImageView *bottomImageView=[[UIImageView alloc]initWithFrame:CGRectMake(0, 58, 524, 304)];
//        bottomImageView.image=[UIImage imageNamed:@"弹出下.png"];
//        bottomImageView.userInteractionEnabled=YES;
//        [self addSubview:bottomImageView];
//        [bottomImageView release];
        
        
        
        palette=[[SmoothLineView alloc]initWithFrame:CGRectMake(10, 50, 894, 450)];
        palette.isNeedDraw = YES;
        palette.backgroundColor = [UIColor whiteColor];
        palette.lineWidth = 5.0;
        [self addSubview:palette];
        [palette release];
        
        UIButton *clearScreen = [[UIButton alloc]initWithFrame:CGRectMake(800, 14, 60, 32)];
        [clearScreen setTitle:@"清屏" forState:UIControlStateNormal];
        [clearScreen setTitleColor:MYCOLOR forState:UIControlStateNormal];
        [clearScreen addTarget:self action:@selector(clearScreenAction) forControlEvents:UIControlEventTouchUpInside];
        [self addSubview:clearScreen];
        [clearScreen release];
        
        
        UIButton *closeBtn=[[UIButton alloc]initWithFrame:CGRectMake(870, 10, 32, 32)];
        closeBtn.backgroundColor=[UIColor clearColor];
        [closeBtn addTarget:self action:@selector(closeBtnAction) forControlEvents:UIControlEventTouchDown];
        [closeBtn setImage:[UIImage imageNamed:@"关闭.png"] forState:UIControlStateNormal];
        [self addSubview:closeBtn];
        [closeBtn release];
        
        
        
    }
    return self;
}
-(void)clearScreenAction{
    [palette removeFromSuperview];
    
    palette=[[SmoothLineView alloc]initWithFrame:CGRectMake(10, 50, 894, 450)];
    palette.isNeedDraw = YES;
    palette.backgroundColor = [UIColor whiteColor];
    palette.lineWidth = 5.0;
    [self addSubview:palette];
    [palette release];
}

-(void)panPieceCaogao:(UIPanGestureRecognizer *)gestureRecognizer{

    UIView *piece = [[gestureRecognizer view] superview];
	if ([gestureRecognizer state] == UIGestureRecognizerStateBegan || [gestureRecognizer state] == UIGestureRecognizerStateChanged) {
        
        [[self superview] bringSubviewToFront:self];
        
		CGPoint translation = [gestureRecognizer translationInView:[piece superview]];
        [piece setCenter:CGPointMake([piece center].x + translation.x, [piece center].y+ translation.y)];
        
        CGRect rect=piece.frame;
        if (rect.origin.y<=0) {
            rect.origin.y=0;
        }
        if (rect.origin.x<=0) {
            rect.origin.x=0;
        }
        if (rect.origin.x+rect.size.width>=1024) {
            rect.origin.x=1024-rect.size.width;
        }
        if (rect.origin.y+rect.size.height>=748) {
            rect.origin.y=748-rect.size.height;
        }
        
        
        piece.frame=rect;
        
		[gestureRecognizer setTranslation:CGPointZero inView:[piece superview]];
	}
}

-(void)closeBtnAction{
    
    self.hidden=YES;
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
