<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/course.css"/>

    <script type="text/javascript">

        var listObj =  {"hw_num": '8%',"hw_title": "20%" ,"hw_time": "20%","hw_object": "20%","hw_operate": "20%",'hw_goin':"20%"};

        $(function() {

            setWidth(listObj);

            // 删除练习
            $('.hw_del span').mouseover(function(){

                $(this).css('color','#26A75B');
            }).mouseout(function(){

                $(this).css('color','');
            })

            $('.hw_del span').click(function(){

                if(confirm("确定要删除该练习吗？")){

                    $(this).closest('.plist').remove();
                }
            })

            // 表格隔行变色
            $('.hw_list .plist').mouseover(function(){

                $(this).css('background','#fff');
            }).mouseout(function(){

                $(this).css('background','');
            })

            // 搜索
            $('.search').click(function(){
                homeworkList();
            });

            // 排序
            $('._ptitle li.sortby').click(function(){

                // 点击选中
                if ($(this).attr('attr') != undefined) {
                    if ($(this).hasClass('on')) {
                        $(this).removeClass('on');
                    } else {
                        $(this).addClass('on');
                    }
                }

                homeworkList();

            }).eq(0).click();

            // 页面加载的时候执行练习列表
            homeworkList();

        })

        // 获取练习列表
        function homeworkList(p) {

            p = p ? p :1;

            // 遍历获取排序
            var order = '';
            $('._ptitle li.sortby').each(function(){

                if ($(this).attr('attr') != undefined) {

                    if ($(this).hasClass('on')) {
                        order += ',' + $(this).attr('attr') + ' ASC';
                    } else {
                        order += ',' + $(this).attr('attr') + ' DESC';
                    }
                }

            });

            order = order.slice(1);

            // 条件变量
            var parm = '';

            if ($('select[name=part_time]').val() != 0) {
                parm += 'ap_created='+$('select[name=part_time]').val();
            }

            if ($('select[name=class]').val() != 0) {
                parm += '&c_id='+$('select[name=class]').val();
            }

            if ($('select[name=crowd]').val() != 0) {
                parm += '&cro_id='+$('select[name=crowd]').val();
            }

            if (order != undefined) {
                parm += '&order='+order;
            }

            parm += '&act_type=2&p='+p;

            $.post('__APPURL__/Homework/lists', parm, function(json) {

                var list = '';
                if (json.list) {

                    for (var i = 0; i < json.list.length; i ++) {
                        list += '<div class="hw_caption hw_List plist"><ul><li class="hw_num" attr='+json.list[i]['ap_id']+'>'+json.list[i]['ap_id']+'</li><li class="hw_title">'+json.list[i]['act_title']+'</li><li class="hw_time">'+json.list[i]['ap_created']+'</li><li class="hw_object">';

                        if (json.list[i]['c_id'] != 0) {
                            list += json.list[i]['c_name'];
                        }

                        if (json.list[i]['cro_id'] != 0) {
                            list += json.list[i]['cro_name'];
                        }

                        list += '</li><li class="hw_goin" onclick="correct('+json.list[i]['ap_id']+')" ><span>查看练习</span></li> </ul></div>';
                    }

                } else {
                    list += '<div class="hw_caption hw_List plist"><ul><li class="hw_num" style="padding-left:300px;">暂无数据</li></ul></div>';
                }

                $('.data').html(list);

                if (json.page == undefined) {
                    $('.page').html('');
                } else {
                    $('.page').html(json.page);
                }

                setWidth(listObj);

            }, 'json');
        }

        function getList(p) {
            homeworkList(p);
        }

        function correct(ap_id) {
            location.href = '__APPURL__/Classwork/correct/ap_id/'+ap_id;
        }
    </script>

    <div class="warp">
        <include file="Public:leftSider"/>
        <div class="t_hwList">
            <div class="filter">
                <div>
                    <label class="space">班&nbsp;&nbsp;&nbsp;级：</label>
                    <select name="class">
                        <option value="0">全部班级</option>
                        <volist name="class" id="class">
                            <option value="{$class.c_id}">{$class.c_name}</option>
                        </volist>
                    </select>
                </div>
                <div>
                    <label>练习布置时间：</label>
                    <select name="part_time">
                        <volist name="partTimeHomework" id="time">
                            <option value="{$key}">{$time.title}</option>
                        </volist>
                    </select>
                </div>
                <div>
                    <label>群&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;组：</label>
                    <select name="crowd">
                        <option value="0">全部群组</option>
                        <volist name="crowd" id="crowd">
                            <option value="{$crowd.cro_id}">{$crowd.cro_title}</option>
                        </volist>

                    </select>
                </div>
                <div class="search">
                    <button>搜索</button>
                </div>
            </div>
            <div class="hw_list fl">
                <div class="hw_caption">
                    <ul class="_ptitle">
                        <li class="hw_num sortby" attr="ap_id">序号</li>
                        <li class="hw_title">练习标题</li>
                        <li class="hw_time sortby" attr="ap_created">布置时间</li>
                        <li class="hw_object">对象</li>
                        <li class="hw_operate">操作</li>
                    </ul>
                </div>
                <div class="data">

                </div>
            </div>
            <div class="page"></div>
        </div>
        <div class="clear"></div>
    </div>
<include file="Public:footer"/>