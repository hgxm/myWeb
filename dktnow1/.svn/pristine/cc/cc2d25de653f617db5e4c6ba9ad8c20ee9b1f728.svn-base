//
//  JiandaView.m
//  ClassRoomStudent
//
//  Created by apple  on 13-7-8.
//  Copyright (c) 2013年 apple . All rights reserved.
//

#import "JiandaView.h"

@implementation JiandaView

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
//        UIView *biaotiView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 1024, 40)];
//        biaotiView.backgroundColor = MYCOLOR;
//        [self addSubview:biaotiView];
//        [biaotiView release];
        
        lblTitle = [[UILabel alloc] initWithFrame:CGRectMake(10, 0, 600, 40)];
        lblTitle.backgroundColor = [UIColor clearColor];
        lblTitle.textColor = MYCOLOR;
        lblTitle.textAlignment = NSTextAlignmentLeft;
        [self addSubview:lblTitle];
        [lblTitle release];
        
        
        
        tiImageview = [[UIImageView alloc]initWithFrame:CGRectMake(10, 40, 600, 250)];
        [self addSubview:tiImageview];
        [tiImageview release];
        

        
    }
    return self;
}


-(void)changUI:(NSMutableDictionary *)dict daan:(NSMutableDictionary *)answerDict index:(int)i{
    
    muAnswerDict = answerDict;
    
    lblTitle.text = [NSString stringWithFormat:@"%d.简答题",i+1];
    
    [NSThread detachNewThreadSelector:@selector(downImage:) toTarget:self withObject:dict];
}


-(void)downImage:(NSMutableDictionary *)dict{
    
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
    
    NSString *strImgURL = [dict objectForKey:@"path"];
    NSString *strFile=[FileManageUnit getFile:strImgURL];
    
    if([FileManageUnit fileIsExist:strFile]==NO){
        
        NSData *imgData = [[[NSData alloc] initWithContentsOfURL:[NSURL URLWithString:strImgURL]] autorelease];
        
        UIImage *image=[[UIImage alloc]initWithData:imgData];
        if(image){
            [dict setObject:image forKey:@"image"];
            [image release];
        }
        if (strFile) {
            [imgData writeToFile:strFile atomically:YES];
            
        }
        
    }else{
        NSData *imgData = [[[NSData alloc] initWithContentsOfFile:strFile] autorelease];
        
        UIImage *image=[[UIImage alloc]initWithData:imgData];
        if(image){
            [dict setObject:image forKey:@"image"];
            [image release];
        }
    }
    
    [self performSelectorOnMainThread:@selector(flushSelfView:) withObject:dict waitUntilDone:NO];
    
    [pool drain];
}
-(void)flushSelfView:(NSMutableDictionary *)dict{


    tiImageview.image = [dict objectForKey:@"image"];
    tiImageview.frame = CGRectMake(10, 40, tiImageview.image.size.width, tiImageview.image.size.height);
    
    
    self.frame = CGRectMake(self.frame.origin.x, self.frame.origin.y, 1024, tiImageview.image.size.height + 65 +10);
    
    UIScrollView *tempScro = (UIScrollView *)[self superview];
    [tempScro setContentSize:CGSizeMake(1024, tiImageview.image.size.height + 65 +10)];
    
    
}

-(void)dealloc{
    
    [super dealloc];
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
