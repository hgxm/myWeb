<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/jquery-ui.css"/>
<load href="/Public/Js/Home/jquery-ui.js"/>
<load href="__PUBLIC__/Css/Ilc/system.css"/>
<div class="warp">
    <include file="Public:left"/>
    <div class="system fl">
        <div class="sys_menu">
            <volist name="secondList" id="selist">
                <a href="__APPURL__{$selist['sn_url']}" <eq name="selist.sn_name" value="Major">class="selected"</eq>>{$selist['sn_title']}</a>
            </volist>
        </div>
        <div class="tools xin_tools">
            <span class="add" attr="1"><i></i>新增</span>
            <span class="add" attr="2"><i></i>删除</span>
        </div>
        <div class="_list fl" id="MajorList">
            <div class="_caption t_caption">
                <ul>
                    <li class="_check"><input type="checkbox" onclick="CheckAll('MajorList')"></li>
                    <li class="_number">编号</li>
                    <li class="_year">专业名称</li>
                    <li class="_operate">管理</li>
                </ul>
            </div>
            <volist name="list" id="vo">
                <div class="_caption _List plist" attr="{$vo.ma_id}">
                    <ul>
                        <li class="_check"><input name="key" type="checkbox" value="{$vo.ma_id}"></li>
                        <li class="_number">{$key+1}</li>
                        <li class="_year" title="{$vo.ma_title}">{$vo.ma_title}</li>
                        <li class="_operate">编辑</li>
                    </ul>
                </div>
            </volist>
        </div>
    </div>
    <div class="clear"></div>
    <!--编辑状态-->
    <input type="hidden" autocomplete="off" name="editStatus" value="0"/>
</div>
<script type="text/javascript">
<!--
    // 表格排列
    var listObj =  {"_check": '10%', "_number": '30%', "_year": "30%", '_operate':"30%"};

    $(function() {
        setWidth(listObj);

        // 编辑
        $(document).on('click','._operate', function(){
            if ($(this).text() == '管理') {
                return false;
            }

            $('input[name=editStatus]').val(1);
            $(this).parents('.plist').addClass('MajorFlag').siblings().removeClass('MajorFlag');
            $('input[name=ma_title]').val($(this).prev().text());
            $(".model_incre").dialog("open");
        })

        // 添加
        $(document).on('click','.add', function(){

            // 添加
            if ($(this).attr('attr') == 1) {
                if ($('input[name=editStatus]').val() == 0) {
                    $('input[name=ma_title]').val('');
                }
                $(".model_incre").dialog("open");

            // 删除
            } else if ($(this).attr('attr') == 2) {

                if (confirm('确定要删除么')) {
                    var str = '';

                    // 获取勾选的专业，过滤栏目编号的复选框
                    $('#MajorList :checkbox').each(function (i) {
                        if ($(this).is(':checked') && i != 0) {
                            str += ',' + $(this).parents('.plist').attr('attr');
                        }
                    })

                    if (str == '') {
                        showMessage('请选择要删除的专业名称');
                        return false;
                    }

                    // 删除
                    $.post('__URL__/delete', 'ma_id=' + str.slice(1), function (json) {
                        if (json.status == 1) {
                            // 删除勾选的专业
                            $('#MajorList :checkbox').each(function (i) {
                                if ($(this).is(':checked')) {
                                    if (i == 0) {
                                        $(this).prop('checked', false);
                                    } else {
                                        $(this).parents('.plist').remove();
                                    }
                                }
                            })
                        } else {
                            showMessage(json.info);
                        }
                    }, 'json');
                }
            }
        })

        // 新增弹框
        $(".model_incre").dialog({
            draggable: true,        // 是否允许拖动,默认为 true
            resizable: true,        // 是否可以调整对话框的大小,默认为 true
            autoOpen: false,        // 初始化之后,是否立即显示对话框,默认为 true
            position :'center',       // 用来设置对话框的位置
            stack : true,       // 对话框是否叠在其他对话框之上。默认为 true
            modal: true,       // 是否模式对话框,默认为 false(模式窗口打开后，页面其他元素将不能点击，直到关闭模式窗口)
            bgiframe: true,         // 在IE6下,让后面遮罩层盖住select
            width: '518',
            height: 'auto',

            show: {     // 对话框打开效果
                effect: "blind",
                duration: 400
            },
            hide: {     // //对话框关闭效果
                effect: "explode",
                duration: 400
            },
            overlay: {
                backgroundColor: '#000',
                opacity: 0.5
            },
            buttons: {
                确定: function() {

                    var _this = $(this), val = $.trim($('input[name=ma_title]').val()), len = parseInt($('.plist').size())+1;
                    if (val == '') {
                        showMessage('请输入专业名称');
                        return;
                    }

                    if (val.length > 15) {
                        showMessage('专业名称不能超过15个字');
                        return;
                    }

                    // 添加
                    if ($('input[name=editStatus]').val() == 0) {
                        $.post('__URL__/insert', 'ma_title=' + val, function (json) {
                            var str = '';
                            if (json.status == 1) {
                                str += '<div class="_caption _List plist" attr="' + json.info + '">'
                                    +  '<ul>'
                                    +  '<li class="_check"><input type="checkbox" name=\'key\' value=' + json.info + '"></li>'
                                    +  '<li class="_number">' + len + '</li>'
                                    +  '<li class="_year" title="' + val + '">' + val + '</li>'
                                    +  '<li class="_operate">编辑</li>'
                                    +  '</ul>'
                                    +  '</div>'
                                $('._list').append(str);
                                setWidth(listObj);
                            } else {
                                showMessage(json.info);
                            }
                            _this.dialog('close');
                        }, 'json');

                    // 更新
                    } else if ($('input[name=editStatus]').val() == 1) {

                        if (val == $('.MajorFlag').find('._year').text()) {
                            _this.dialog('close');
                            return;
                        }

                        $.post('__URL__/update', 'ma_title=' + val + '&ma_id=' + $('.MajorFlag').attr('attr'), function (json) {
                            var str = '';
                            if (json.status == 1) {
                                $('.MajorFlag').find('._year').html(val);
                            } else {
                                showMessage(json.info);
                            }
                            $('input[name=editStatus]').val(0)
                            _this.dialog('close');
                        }, 'json');
                    }
                },
                取消: function() {
                    $('input[name=editStatus]').val(0);
                    $(this).dialog('close');
                }
            }
        })
    })
//-->
</script>
<include file="Public:footer"/>
<!--弹窗-->
<div class="model_cor model_incre" title="专业设置">
    <ul>
        <li>
            <label>专业名称：</label>
            <input type="text" name="ma_title" class="model_name"/>
        </li>
    </ul>
</div>