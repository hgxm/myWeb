<include file="Public:header"/>
<load href="__PUBLIC__/Css/Home/upgrade.css"/>
    <script type="text/javascript">
    <!--
        $(function(){

            // 隐藏专业
            $('.major').hide();

            // 页面加载的时候获取班级数据
            getClassData();

            

            // 根据学段选择年级
            $('.seg').change(function() {
                // 判断是否为大学
                if ($(this).val() == 4) {
                    $('.major').show();
                } else {
                    $('.major').hide();
                }

                var str = '<option value="0">所属年级</option>';
                $('.gradeType div').eq($(this).val() -1).find('span').each(function() {
                    str += '<option value="'+$(this).attr('attr')+'">'+$(this).html()+'</option>';
                })
                $('.grade').html(str);
            })
            

            // 批量注册班级
            $('.add_btn').click(function(){

                var as_id = $('input[name=as_id]').val();
                var s_id = $('input[name=s_id]').val();
                var type = $('.seg option:selected').attr("value");
                var grade = $('.grade option:selected').attr("value");
                var major = $('.major option:selected').attr("value"), ma_id = $('.major').css('display') != 'none' ? major : 0;
                var title = $('select[name=class_name]').val();

                // 所属学段不能为空
                if(type == 0){

                    showMessage("请选择学段");
                    return false;
                }

                // 若是为大学，所属专业不能为空
                if ($('.seg option:selected').val() == 4 && $('.major option:selected').val() == 0) {
                    showMessage("请选择专业");
                    return false;
                }

                // 所属年级不能为空
                if(grade == 0){

                    showMessage("请选择年级");
                    return false;
                }
                // 编辑名称不能为空
                if(title == 0){

                    showMessage("请填写班级名称");
                    return false;
                }

                // 专业名称
                ma_title = '';
                if (ma_id) {
                    ma_title = $('.major option:selected').text();
                }

                $.post('__APPURL__/ApplyClass/insert', 'type='+type+'&grade='+grade+'&title='+title+'&as_id='+as_id+'&s_id='+s_id+'&ma_id='+ma_id, function(json){

                    if (json.status > 0) {

                        var classes = "<li class='list_option'><span class='cap_num'>"+json.status+"</span><span class='cap_seg'>"+$('.seg option:selected').html()+"</span><span class='cap_grade'>"+$('.grade option:selected').html()+"</span><span class='cap_name'>" + ma_title + "("+title+")班</span><span class='cap_operate'><a href='__APPURL__/ApplyAuth/index/ac_id/"+json.status+"/as_id/"+as_id+"/s_id/"+s_id+"'><i>添加学生</i></a></span></li>";

                        $('#data').append(classes);

                        // 隔行变色
                        tableColor();

                    } else {
                        showMessage('该班级已经添加过, 请重新选择');
                    }
                }, 'json');
            })
        })

        // 隔行变色
        function tableColor() {
            $('li.list_option:odd').each(function(){

                $(this).css('background','#F5FFE1');
            })
        }

        // 获取班级数据
        function getClassData(p) {

            p = p ? p : 1;

            var as_id = $('input[name=as_id]').val();
            var s_id = $('input[name=s_id]').val();

            $.post('__APPURL__/ApplyClass/lists', 'as_id='+as_id+'&s_id='+s_id+'&p='+p, function(json){

                if (json.list) {

                    var str = '';
                    for (var i = 0; i < json.list.length; i++) {

                        str += "<li class='list_option'><span class='cap_num'>"+json['list'][i]['ac_id']+"</span><span class='cap_seg'>"+json['list'][i]['ac_type']+"</span><span class='cap_grade'>"+json['list'][i]['ac_grade']+"</span><span class='cap_name'>" + json['list'][i]['ma_title'] + "("+json['list'][i]['ac_title']+")班</span><span class='cap_operate'><a href='__APPURL__/ApplyAuth/index/ac_id/"+json['list'][i]['ac_id']+"/as_id/"+as_id+"/s_id/"+s_id+"'><i>添加学生</i></a></span><span>"
                        if (json['list'][i]['ac_is_pass'] != 0) {
                            str += '已通过审核';
                        }
                        str += "</span></li>";

                    }

                    $('#data').html('');
                    $('#data').html(str);
                    $('.page').html(json.page);

                    // 班级列表隔行变色
                    tableColor();

                }

            }, 'json');
        }

        // 分页
        function getList(p) {
            getClassData(p);
        }

    //-->
    </script>

    <div class="warp">
    <input type="hidden" name="as_id" value="{$as_id}"/>
    <input type="hidden" name="s_id" value="{$s_id}"/>
        <div class="add_school">
            <div class="tit">
                <span>批量注册班级</span>
            </div>

            <div class="mt_box">

                <div class="step_by reg_class">
                    <div class="filter">
                        <span>选择你要批量注册的班级：</span>
                        <select class="seg">
                            <option value="0">所属学段</option>
                            <volist name="types" id="type">
                                <option value="{$type.id}">{$type.title}</option>
                            </volist>
                        </select>
                        <select class="major">
                            <option value="0">所属专业</option>
                            <volist name="major" id="vo">
                                <option value="{$vo.ma_id}">{$vo.ma_title}</option>
                            </volist>
                        </select>
                        <select class="grade">
                            <option value="0">所属年级</option>
                        </select>

                        <div class="class_name fl">
                            <label>班级：</label>
                            <select name="class_name">
                                <option value="0">请选择</option>
                                <volist name="classList" id="class">
                                    <option value="{$class.title}">{$class.show}</option>
                                </volist>
                            </select>
                            
                        </div>
                        <a class="add_btn"></a>
                    </div>
                    <div class="filter_result">
                        <span class="reged">我已批量注册的班级：</span>
                        <ul>
                            <li class="caption">
                                <span class="cap_num">序号</span>
                                <span class="cap_seg">学段</span>
                                <span class="cap_grade">年级</span>
                                <span class="cap_name">班级名称</span>

                                <span class="cap_operate">操作</span>
                            </li>
                            <div id="data">

                            </div>
                        </ul>
                        <div class="page"></div>
                    </div>
                </div>
            </div>

        </div>
        <div class="clear"></div>
    </div>
    <div class='gradeType' style='display:none;'>
        <volist name='grade' id="ng">
            <div>
                <volist name="ng" id="ngr" key="k">
                    <span attr="{$k}">{$ngr}</span>
                </volist>
            </div>
        </volist>
    </div>
<include file="Public:footer"/>