<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <script type="text/javascript" src="./Js/jquery-1.9.1.js" ></script>
    <script type="text/javascript" src="./Js/public.js" ></script>
    <link href="./Css/public.css" type="text/css" rel="stylesheet">
    <link href="./Css/index.css" type="text/css" rel="stylesheet">
    <link href="./Css/jquery-ui.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="./Js/jquery-ui.js" ></script>
    <!--[if IE 6]>
    <script type="text/javascript" src="./Js/png.js" ></script>
    <script type="text/javascript">
        DD_belatedPNG.fix('#logo,.cShare,.cEdit,.cIn,.cClone,.cExport,.cDel,.fw_baoming_left,.fw_btn,.anli_ico_link,.anli_ico,.selected,.selected_green,.selected_gray,.to-left,.to-right,.current,.mt_tab li,.classhomework_top li,.choose_class,.current img,.res_click,.res_scan,.res_frame.png,#main_bg li img,.jCal .left,.jCal .right');
    </script>
    <![endif]-->
    <title>大课堂互动教学</title>
    <script>
        <!--//

            // 导航动画效果
            $(function(){

                $('#header li a').wrapInner('<span class="out"></span>');

                $('#header li a').each(function() {
                    $('<span class="over">' + $(this).text() + '</span>').appendTo(this);
                });

                $('#header li a').hover(function() {
                    $('.out',this).stop().animate({'top':'67px'},200);
                    $('.over',this).stop().animate({'top':'0px'},200);

                }, function() {
                    $('.out',this).stop().animate({'top':'0px'},200);
                    $('.over',this).stop().animate({'top':'-67px'},200);
                });
                
                $('#header li a').click(function(){

                    // 选中菜单项的样式
                    $(this).addClass('on').parent().siblings().find('a').removeClass('on');

                    // 恢复动画
                    $('.out',this).css('top','0px');
                    $('.over',this).css('top','-67px');
                    $(this).parent().siblings().find('a').hover(function(){
                        $('.out',this).stop().animate({'top':'67px'},200);
                        $('.over',this).stop().animate({'top':'0px'},200);
                    }, function() {
                        $('.out',this).stop().animate({'top':'0px'},200);
                        $('.over',this).stop().animate({'top':'-67px'},200);
                    })
                    // 停止当前点击导航的动画效果
                    $(this).hover(function(){
                        $('.out',this).stop();
                        $('.over',this).stop();
                    },function(){
                        $('.out',this).stop();
                        $('.over',this).stop();
                    })
                }).eq(0).click();
            })
        //-->
    </script>
</head>
<body id="body">
    <div id="header">
        <div>
            <a href="javascript:void(0);" id="logo"></a>
            <ul class="nav">
                <li><a href="javascript:;">课程超市</a></li>
                <li><a href="javascript:;">我的空间</a></li>
                <li><a href="javascript:;">资源中心</a></li>
                <li><a href="javascript:;">应用中心</a></li>
            </ul>
            <a href="javascript:void(0);" class="download">iPhone客户端下载</a>
        </div>
    </div>
                <script type="text/javascript" language="javascript">

        $(function () {

            // 页面加载时，隐藏课时相关的模块
            $('.second').hide();

            // 鼠标移上资源 显示资源操作按钮
            $(document).on('mouseover', '.res_cover', function(){
                $(this).children('.tools_cover').show();
            })
            $(document).on('mouseout', '.res_cover', function(){
                $(this).children('.tools_cover').hide();
            })

            // 分页加载课时资源
            $(document).on('click', '.resourcePage', function () {

                // 重新加载课时分页
                getPage(1)
            })

            // 浏览课时资源
            $(document).on('click', '.scan', function () {
                var obj = $(this).parents('.res_cover');
                var id = obj.attr('rel');
                if (obj.attr('trans') != 1) {
                    showMessage('该附件未转码，暂时不能预览');
                    return;
                } else {
                    $(this).attr({'target':'_blank', 'href':'./show.html?mid=' + $(this).attr('mid') + '&src=' + $(this).attr('name')});
                }
            })

            // 单元展开与收缩
            $(document).on('click', '.unit_switch',function(){

                var _this = $(this);
                if(_this.hasClass('tree_switch_plus')){
                    _this.removeClass('tree_switch_plus').addClass('tree_switch_sub');
                } else {
                    _this.removeClass('tree_switch_sub').addClass('tree_switch_plus');
                }

                if (_this.hasClass('tree_switch_sub')) {
                    if (_this.next().next().find('li').size() == 0) {
                        $.post('./Data/lesson.txt', '', function (json) {
                            var htm = '';
                            if (json) {
                                for (var i=0, len=json.length; i<len; i++) {
                                    if (json[i]['l_pid'] != 0 && json[i]['l_pid'] == _this.parent().attr('rel')) {
                                        htm += "<li rel='" + json[i]['l_id'] + "'>"
                                            +"<span class='tree_switch tree_switch_plus kw_switch'></span>"
                                            +"<a class='tree_unit_a child_node_a' rel='" + json[i]['l_id'] + "'>"
                                            +"<span class='tree_branch child_node_span' rel='" + json[i]['l_id'] + "' title='" + json[i]['l_title'] + "'>" + json[i]['l_title'] + "</span>"
                                            +"<span class='button add_c'></span>"
                                            +"<span class='button edit_c'></span>"
                                            +"<span class='button del_c'></span>"
                                            +"</a>"
                                            +"<ul class='stree stree_drag ui-sortable'></ul>"
                                            +"</li>"
                                    }
                                }
                            }
                            _this.parent().children('.ctree').html(htm);
                            _this.siblings('.ctree').slideToggle();
                        }, 'json')
                    }
                    _this.siblings('.ctree').slideToggle();
                } else {
                    _this.siblings('.ctree').slideToggle();
                }
            })

            // 课文展开与收缩
            $(document).on('click','.kw_switch',function(){

                var _this = $(this);

                if(_this.hasClass('tree_switch_plus')){
                    _this.removeClass('tree_switch_plus').addClass('tree_switch_sub');
                } else {
                    _this.removeClass('tree_switch_sub').addClass('tree_switch_plus');
                }

                if (_this.hasClass('tree_switch_sub')) {
                    if (_this.next().next().find('li').size() == 0) {
                        $.post('./Data/classhour.txt', '', function (json) {
                            var htm = '';
                            if (json) {
                                for (var i=0, len=json.length; i<len; i++) {
                                    if (json[i]['l_id'] == _this.parent().attr('rel')) {
                                        htm += '<li rel="' + json[i]['cl_id'] + '" c_id="' + json[i]['c_id'] + '" cro_id="' + json[i]['cro_id'] + '">'
                                            +'<a class="tree_unit_a grandchild_node_a">'
                                            +'<span class="tree_branch grandchild_node_span" title="' + json[i]['cl_title'] + '" rel="' + json[i]['cl_id'] + '" ar_id="' + json[i]['ar_id'] + '">' + json[i]['cl_title'] + '</span>'
                                            +'<span class="button edit_ks" style="display: none;"></span>'
                                            +'<span class="button del_ks" style="display: none;"></span>'
                                            +'</a>'
                                            +'</li>'
                                    }
                                }
                            }
                            _this.parent().children('.stree').html(htm);
                            _this.siblings('.stree').slideToggle();
                        }, 'json')
                    }
                    _this.siblings('.stree').slideToggle();
                } else {
                    _this.siblings('.stree').slideToggle();
                }
            })

            // 点击单元题目 展开子节点
            $(document).on('click', '.tree_branch', function(){
                var _this = $(this);
                if (!_this.hasClass('child_node_span') && _this.html() != '<input class="edit_node" onkeydown="keydown(event)">') {
                    if(_this.parent().prev().hasClass('tree_switch_plus')){
                        _this.parent().prev().removeClass('tree_switch_plus').addClass('tree_switch_sub');
                    } else {
                        _this.parent().prev().removeClass('tree_switch_sub').addClass('tree_switch_plus');
                    }

                    if (_this.parent().prev().hasClass('tree_switch_sub')) {
                        if (_this.parent().next().find('li').size() < 1) {
                            syncLesson(_this);
                        }
                        _this.parent().siblings('.ctree').slideToggle();
                    } else {
                        _this.parent().siblings('.ctree').slideToggle();
                    }
                }
            })

            // 点击课文题目 展开课时
            $(document).on('click', '.child_node_span', function(){
                var _this = $(this);
                if (_this.html() != '<input class="edit_node" onkeydown="keydown(event)">') {
                    if(_this.parent().prev().hasClass('tree_switch_plus')){
                        _this.parent().prev().addClass('tree_switch_sub').removeClass('tree_switch_plus');
                    } else {
                        _this.parent().prev().removeClass('tree_switch_sub').addClass('tree_switch_plus');
                    }

                    if (_this.parent().prev().hasClass('tree_switch_sub')) {
                        if (_this.parent().next().find('li').size() < 1) {
                            syncClasshour(_this);
                        }
                        _this.parent().siblings('.stree').slideToggle();
                    } else {
                        _this.parent().siblings('.stree').slideToggle();
                    }
                }
            })

            // 选中活动
            $('#add_module li').click(function(){

            })


            // 环节展开与收缩
            $(document).on('click','.tache_arrow',function(){

                var _arrow = $(this);
                if(_arrow.hasClass("tache_up")){
                    _arrow.removeClass('tache_up').addClass('tache_down');
                }else {
                    _arrow.removeClass('tache_down').addClass('tache_up');
                }

                _arrow.parent().siblings().slideToggle();
            })

            // 网格切换列表
            $('.order_switch .list').click(function(){
                $(this).addClass('on').siblings().removeClass('on');

                $('.tache_box .tache li').each(function(){
                    $(this).find('.thumbAct').parent().hide();
                    $(this).find('.listAct').parent().show();
                })
            })

            // 列表切换网格
            $('.order_switch .thumb').click(function(){
                $(this).addClass('on').siblings().removeClass('on');

                $('.tache_box .tache li').each(function(){
                    $(this).find('.thumbAct').parent().show();
                    $(this).find('.listAct').parent().hide();
                })
            })

            // 教学活动的展开与收缩
            $(document).on('click','.topic_arrow',function(){

                var _arrow = $(this);
                if(_arrow.hasClass("topic_up")){
                    _arrow.removeClass('topic_up').addClass('topic_down');
                }else {
                    _arrow.removeClass('topic_down').addClass('topic_up');
                }

                if (_arrow.hasClass('topic_up')) {

                    var act_type = _arrow.next().attr('act_type');
                    var act_rel = _arrow.next().attr('act_rel');
                    var ar_id = _arrow.next().attr('ar_id');
                    var htm = '';

                    // 作业、练习、拓展阅读
                    if (act_type == 1 || act_type == 2 || act_type == 5) {
                        if (ar_id != 'null') {
                            ar_id = ',' + ar_id + ',';
                            $.post('./Data/resource.txt', '', function (json) {
                                if (json) {
                                    for (var k=0; k<json.length; k++) {
                                        if (ar_id.indexOf(',' + json[k]['ar_id'] + ',') == -1) {
                                            continue;
                                        }
                                        htm += '<li rel="' + json[k]['ar_id'] + '" class="ListFiles" trans="' + json[k]['ar_is_transform'] + '">'
                                             +  '<a class="li_cover" href="javascript:void(0)" target="" name="' + json[k]['ar_savename'] + '" mid="' + json[k]['m_id'] + '">'
                                             +  '<img src="' + json[k]['ar_upload'] + '" width="100" height="75" title="' + json[k]['ar_title'] + '">'
                                             +  '</a>'
                                             +  '<a class="file_name" href="javascript:void(0);" title="' + json[k]['ar_title'] + '" name="' + json[k]['ar_savename'] + '" mid="' + json[k]['m_id'] + '">' + json[k]['ar_title'] + '</a>'
                                             +  '</li>'
                                    }
                                }
                            // 显示内容
                            _arrow.parent().next().find('.resourceContent .uploadedList').html(htm);
                            }, 'json')
                        }
                        if (act_type == 5) {
                            ar_id = ',' + act_rel + ',';
                            $.post('./Data/resource.txt', '', function (json) {
                                if (json) {
                                    for (var k=0; k<json.length; k++) {
                                        if (ar_id.indexOf(',' + json[k]['ar_id'] + ',') == -1) {
                                            continue;
                                        }
                                        htm += '<li rel="' + json[k]['ar_id'] + '" class="ListFiles" trans="' + json[k]['ar_is_transform'] + '">'
                                             +  '<a class="li_cover" href="javascript:void(0)" target="" name="' + json[k]['ar_savename'] + '" mid="' + json[k]['m_id'] + '">'
                                             +  '<img src="' + json[k]['ar_upload'] + '" width="100" height="75" title="' + json[k]['ar_title'] + '">'
                                             +  '</a>'
                                             +  '<a class="file_name" href="javascript:void(0);" title="' + json[k]['ar_title'] + '" name="' + json[k]['ar_savename'] + '" mid="' + json[k]['m_id'] + '">' + json[k]['ar_title'] + '</a>'
                                             +  '</li>'
                                    }
                                }
                            // 显示内容
                            _arrow.parent().next().find('.resourceContent .uploadedList').html(htm);
                            }, 'json')
                        }
                        if (act_rel != '' && act_type != 5) {
                            var ht = '';
                            act_rel = ',' + act_rel + ',';
                            $.post('./Data/topic.txt', '', function (json) {
                                if (json) {
                                    for (var k=0, len=json.length; k<len; k++) {
                                        if (act_rel.indexOf(',' + json[k]['to_id'] + ',') == -1) {
                                            continue;
                                        }
                                        ht += '<div class="resour_online" rel="' + json[k]['to_id'] + '" attr="' + json[k]['to_type'] + '">'
                                                +  '<i>' + getIdByTopicType(json[k]['to_type']) + '</i>'
                                                +  '<div class="online_cursor">'
                                                +  '' + json[k]['to_title'] + ''
                                                + '<div>';
                                        if (json[k]['to_type'] == 1) {
                                            ht += syncSingle(syncCount, json[k]['to_option'], json[k]['to_answer']);
                                        } else if (json[k]['to_type'] == 2) {
                                            ht += syncMulti(json[k]['to_option'], json[k]['to_answer']);
                                        } else if (json[k]['to_type'] == 3) {
                                            ht += syncFill(json[k]['to_option'], json[k]['to_answer']);
                                        } else if (json[k]['to_type'] == 4) {
                                            ht += syncJudge(syncCount, json[k]['to_option'], json[k]['to_answer']);
                                        } else {
                                            ht += '<label style="cursor: pointer;">' + syncShort(json[k]['to_answer']) + '</label>';
                                        }
                                        ht += '</div>'
                                            +  '</div>'
                                            +  '</div>';
                                        syncCount++;
                                    }
                                }
                                // 显示内容
                                _arrow.parent().next().find('.resourceContent .topic').html(ht);
                            }, 'json')
                        }

                    // 文本
                    } else if (act_type == 3) {
                        htm = '<div class="resour_online">'
                             + '<i>&nbsp;</i>'
                             + '<div class="online_cursor">'
                             + '<div>' + _arrow.next().attr('act_note') + '</div>';
                             + '</div>'
                             + '</div>';
                        // 显示内容
                        _arrow.parent().next().find('.resourceContent').html(htm);
                    // 外链
                    } else if (act_type == 4) {
                        $.post('./Data/link.txt', '', function (json) {
                            var li_id = ',' + act_rel + ',';
                            if (json) {
                                htm = '<h3>&nbsp;</h3>';
                                for (var i=0, len=json.length; i<len; i++) {
                                    if (li_id.indexOf(',' + json[i]['li_id'] + ',') == -1) {
                                        continue;
                                    }
                                    htm += '<div class="resour_online" rel="' + json[i]['li_id'] + '>'
                                        +  '<i>' + json[i]['li_title'] + '</i>'
                                        +  '<div class="online_cursor">'
                                        + '<div><a href="' + json[i]['li_url'] + '" target="_blank">' + json[i]['li_title'] + '</a></div>'
                                        +'</div>'
                                        +'</div>';
                                }
                            }

                        // 显示内容
                        _arrow.parent().next().find('.resourceContent').html(htm);
                        }, 'json')
                    }


                    _arrow.parent().siblings().slideToggle();
                } else {
                    _arrow.parent().siblings().slideToggle();
                }
            })

            // 点击未转码的资源，给予提示
            $(document).on('click', '.ListFiles', function () {
                if ($(this).attr('trans') != 1) {
                    showMessage('该附件未转码，暂时不能预览');
                } else {
                    $(this).find('a').each(function () {
                        $(this).attr({'target':'_blank', 'href':'./show.html?mid=' + $(this).attr('mid') + '&src=' + $(this).attr('name')});
                    })
                }
            })

            // 右侧资源tab切换
            $(document).on('click', '.res_tab li', function(){

                $(this).addClass("on").siblings().removeClass("on");
                var index =  $(".res_tab li").index(this);
                $(".resBox .res_box").eq(index).show().siblings().hide();
            })

            // 点击课时
            $(document).on('click','.grandchild_node_span',function(){

                var _this = $(this);

                $('.second').show();

                // 选中的课时加亮显示
                $('.grandchild_node_span').each(function () {
                    if (_this.attr('rel') == $(this).attr('rel')) {
                        $(this).addClass('on')
                    } else {
                        $(this).removeClass('on')
                    }
                })

                // 在编辑课时标题时或是当前环节是该课时下时，禁止加载内容
                if (_this.html() != '<input class="edit_node" onkeydown="keydown(event)">' && $('input[name=cl_id]').val() != _this.attr('rel')) {

                    // 存储课时ID，避免重复加载
                    $('input[name=cl_id]').val(_this.attr('rel'));

                    // 存储课时资源ID
                    $('input[name=ar_id]').val(_this.attr('ar_id'));

                    // 存储课文ID
                    $('input[name=l_id]').val(_this.parents('.stree').parent().attr('rel'));

                    // 动态显示课文 >> 课时
                    var courseTitle = "数学(人教版)"
                    $('.courseTitle').html('');
                    $('.courseTitle').html(courseTitle + ' >> ' + _this.parents('.ctree').prev().find('.tree_branch').text());
                    $('.title').html(_this.parents('.stree').prev().find('.tree_branch').text() + ' >> ' + _this.text());

                    // 异步加载环节、活动
                    $.post('./Data/tache.txt', '', function (json) {
                        $('.order_switch .thumb').click();
                        var htm='';
                        if (json) {
                            for (var i=0, len=json.length; i<len; i++) {
                                if (json[i]['cl_id'] != $('input[name=cl_id]').val()) {
                                    continue;
                                }
                                htm += '<div class="tache fl" rel="' + json[i]['ta_id'] + '">'
                                    +'<div class="act_top" rel="' + json[i]['ta_id'] + '">'
                                    +'<label class="node_name" rel="' + json[i]['ta_id'] + '" title="' + json[i]['ta_title'] + '">' + json[i]['ta_title'] + '</label>'
                                    +'<a class="tache_arrow tache_up"></a>'
                                    +'</div>'
                                    +'<div class="act_box fl">'
                                    +'<ul class="act_box_ul">'
                                    +'</ul>'
                                    +'</div>'
                                    +'</div>';
                            }
                        }
                        $('.tacheList').html(htm);
                        $('.tache_box').show();
                        $('.order_switch').show();
                        $.post('./Data/activity.txt', '', function (json) {
                            htm = '';
                            $('.act_box_ul').each(function (i) {
                                htm = '';
                                for (var j=0, l=json.length; j<l; j++) {
                                    if (json[j]['ta_id'] != $(this).parents('.tache').attr('rel')) {
                                        continue;
                                    }
                                    htm += '<div class="liliObj" rel="' + json[j]['act_id'] + '">'
                                        +'<li class="lili flex_add homework">'
                                        +'<div class="thumbAct" act_type="' + json[j]['act_type'] +'">'
                                        +'<div class="' + getTypeById(json[j]['act_type']) + '"></div>'
                                        +'<span title="' + json[j]['act_title'] + '" rel="' + json[j]['act_id'] + '">' + json[j]['act_title'] + '</span>'
                                        +'<a class="flex_del" rel="' + json[j]['act_is_published'] + '" style="display: none;"></a>'
                                        +'</div>'
                                        +'</li>'
                                        +'<li class="lili act_option" style="display: none;">'
                                        +'<div class="listAct">'
                                        +'<div class="act_title">'
                                        +'<a class="topic_arrow topic_down"></a>'
                                        +'<span title="' + json[j]['act_title'] + '" rel="' + json[j]['act_id'] + '" act_type="' + json[j]['act_type'] + '" act_rel="' + json[j]['act_rel'] + '" ar_id="' + json[j]['ar_id'] + '" act_note="' + json[j]['act_note'] + '">' + json[j]['act_title'] + '</span>'
                                        +'</div>'
                                        +'<div class="topicBox" style="display: none;">'
                                        +'<div class="resourceContent"><h3></h3><ul class="uploadedList"></ul><div class="topic"></div></div>'
                                        +'</div>'
                                        +'</div>'
                                        +'</li>'
                                        +'</div>'
                                }
                                $(this).html(htm);
                            })
                        }, 'json')
                    }, 'json')
                    $('.res_box_ul').html('');
                    getPage();
                }
            })

            // 资源上翻看
            $(document).on('click', '.pageUp', function(){
                var page = parseInt($(this).attr('page'));
                if (page && page > 0) {
                    getPage(page, 'up');
                }
            })

            // 资源下翻看
            $(document).on('click', '.pageDown', function(){
                var page = parseInt($(this).attr('page'));
                if (page && page > 1) {
                    getPage(page, 'down');
                }
            })
        })

        // 课时分页
        function getPage(p, flag) {
            var p = p ? p : 1;
            var flag = flag ? flag : 'down';
            var ar_id = $('.tree .on').attr('ar_id');
            var sum = 0;
            if (ar_id != '') {
                ar_id = ar_id.slice(1,-1);
                ar_id = ar_id.split(',');
                ar_id = ar_id.reverse();
                var tmp = '';
                var str = '';
                if (5 > ar_id.length) {
                    str = ar_id.join(',');
                    sum = 1;
                } else {
                    tmp = 5*(p-1);
                    str = ar_id.slice(tmp, tmp+5).join(',');
                    sum = Math.ceil(ar_id.length/5);
                }
                $.post('./Data/resource.txt', '', function (json) {
                    var ht = ''
                    if (json) {
                        str = ',' + str + ',';
                        for (var i=0, len=json.length; i<len; i++) {
                            if (str.indexOf(',' + json[i]['ar_id'] + ',') == -1) {
                                continue;
                            }
                            ht += '<li rel="' + json[i]['ar_id'] + '">'
                               +'<div class="res_cover" trans="' + json[i]['ar_is_transform'] + '" rel="' + json[i]['ar_id'] + '">'
                               +'<img src="' + json[i]['ar_upload'] + '" width="100" height="75">'
                               +'<div class="tools_cover">'
                               +'<div class="fr">'
                               +'<a href="javascript:void(0)" class="res_scan scan" name="./Resource/' + json[i]['ar_savename'] + '" mid="' + json[i]['m_id'] + '"></a>'
                               +'</div>'
                               +'</div>'
                               +'</div>'
                               +'<a class="res_title" href="javascript:void(0)" title="' + json[i]['ar_title'] + '">' + json[i]['ar_title'] + '</a>'
                               +'</li>'
                        }

                        if (p != sum) {
                            // 上一页
                            $('.pageUp').attr('page', p);

                            // 下一页
                            $('.pageDown').attr('page', parseInt(p)+1);
                            if (flag == 'up' && p > 1) {
                                // 上一页
                                $('.pageUp').attr('page', $('.pageUp').attr('page')-1);

                                // 下一页
                                $('.pageDown').attr('page', $('.pageDown').attr('page')-1);
                            }
                        }
                    }
                    if (ht != '') {
                        $('.res_box_ul').html(ht);
                    }
                }, 'json');
            }
        }

        // 点击网络或是列表的活动模块，进入相对应的iframe里
        function editIframe(obj) {

        }

        var syncCount = 1111;

        // 异步查询该单元下的课文
        function syncLesson(_this) {
            $.post('./Data/lesson.txt', '', function (json) {
                var htm = '';
                if (json) {
                    for (var i=0, len=json.length; i<len; i++) {
                        if (json[i]['l_pid'] != 0 && json[i]['l_pid'] == _this.parent().attr('rel')) {
                            htm += "<li rel='" + json[i]['l_id'] + "'>"
                                +"<span class='tree_switch tree_switch_plus kw_switch'></span>"
                                +"<a class='tree_unit_a child_node_a' rel='" + json[i]['l_id'] + "'>"
                                +"<span class='tree_branch child_node_span' rel='" + json[i]['l_id'] + "' title='" + json[i]['l_title'] + "'>" + json[i]['l_title'] + "</span>"
                                +"<span class='button add_c'></span>"
                                +"<span class='button edit_c'></span>"
                                +"<span class='button del_c'></span>"
                                +"</a>"
                                +"<ul class='stree stree_drag ui-sortable'></ul>"
                                +"</li>"
                        }
                    }
                }
                _this.parent().next().html(htm);
                _this.parent().siblings('.ctree').slideToggle();
            }, 'json')
        }

        // 异步查询该课文下的课时
        function syncClasshour(_this) {
            $.post('./Data/classhour.txt', '', function (json) {
                var htm = '';
                if (json) {
                    for (var i=0, len=json.length; i<len; i++) {
                        if (json[i]['l_id'] == _this.parent().attr('rel')) {
                            htm += '<li rel="' + json[i]['cl_id'] + '" c_id="' + json[i]['c_id'] + '" cro_id="' + json[i]['cro_id'] + '">'
                                +'<a class="tree_unit_a grandchild_node_a">'
                                +'<span class="tree_branch grandchild_node_span" title="' + json[i]['cl_title'] + '" rel="' + json[i]['cl_id'] + '" ar_id="' + json[i]['ar_id'] + '">' + json[i]['cl_title'] + '</span>'
                                +'<span class="button edit_ks" style="display: none;"></span>'
                                +'<span class="button del_ks" style="display: none;"></span>'
                                +'</a>'
                                +'</li>'
                        }
                    }
                }
                _this.parent().next().html(htm);
                _this.parent().siblings('.stree').slideToggle();
            }, 'json')
        }

        // 依据活动类型，返回活动样式
        function getTypeById(id) {
            var arr = ['', 'add_homework', 'add_execrise', 'add_text', 'add_link', 'add_read'];
            return arr[id];
        }

        function choose(obj) {
            if (obj.parent().hasClass('click')) {
                obj.parent().removeClass('click');
            } else {
                obj.parent().addClass('click');
            }
        }

        // 处理题型为3的json字符串
        function procJsonCode(jsonCode) {

            var str = eval('(' + jsonCode + ')');
            return str.join(':');
        }

        // 单选题
        function syncSingle(i, num, answer) {
            var num = num.split(',');
            var html = '';
            var answer = eval('(' + answer + ')');
            for (var j = 0; j < num.length; j++) {
                html += '<input type="radio" value="' + j + '" name="single' + i + '"';
                if (j == parseInt(answer)) {
                    html += 'checked="checked"';
                }
                html += '><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
            }

            return html;
        }

        // 多选题
        function syncMulti(num, answer) {

            var num = num.split(',');
            var answer = eval('(' + answer + ')');
            var answer1 = answer[0].split(',');
            var html = '';
            for (var j = 0; j < num.length; j++) {
                tmp = syncArray(j, answer1);
                if (tmp) {
                    html += tmp;
                } else {
                    html += '<input type="checkbox" name="multiple" value="0"><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
                }
            }
            return html;
        }

        function syncArray(j, answer) {
            html = '';
            for (var jj = 0; jj < answer.length; jj++) {
                if (answer[jj] == j) {
                    html += '<input type="checkbox" name="multiple" value="0" checked=""><label class="option" style="cursor: pointer;">' + infor(j) + '</label>';
                }
            }
            return html;
        }

        // 填空题
        function syncFill(num, answer) {
            var obj = eval('(' + answer + ')')
            var num = num.split(',');
            var html = '';
            for (var i = 0; i < num.length; i++) {
                html += '<li class="noline"><label style="cursor: pointer;">' + (i + 1) + '、' + obj[i] + '</label></li>';
            }
            return html;
        }


        // 判断题
        function syncJudge(i,num, answer) {
            var answer = eval('(' + answer + ')');
            answer = parseInt(answer);
            var html = '';
            html += '<input type="radio" name="judge' + i + '" ' + ((answer == 0) ? 'checked=""' : '') + '><label attr="1" style="cursor: pointer;" class="option"><img height="20" width="20" border="0" src="/Public/Images/Home/ok.png"></label>';
            html += '<input type="radio" name="judge' + i + '" ' + ((answer == 1) ? 'checked=""' : '') + '><label attr="2" style="cursor: pointer;" class="option"><img height="20" width="20" border="0" src="/Public/Images/Home/err.png"></label>'
            return html;
        }

        // 返回答案选项
        function infor(i) {
            var arr = new Array();
            arr[0] = 'A';
            arr[1] = 'B';
            arr[2] = 'C';
            arr[3] = 'D';
            arr[4] = 'E';
            arr[5] = 'F';
            return arr[i % 6];
        }

        // 已经题型id获取题型汉字信息
        function getIdByTopicType(id) {

            var word = '';

            switch (parseInt(id)) {
                case 1:
                    word = '单项选择题';
                    break;
                case 2:
                    word = '多项选择题';
                    break;
                case 3:
                    word = '填空主观题';
                    break;
                case 4:
                    word = '判断题';
                    break;
                case 5:
                    word = '简答题';
                    break;
            }

            return word;
        }

        // 简答
        function syncShort(answer) {
            var answer = eval('(' + answer + ')');
            return answer;
        }
    </script>
    <div class="warp">
            <!-- 存储上次单击的课时名称-->
            <input type="hidden" autocomplete="off" name="inputName" value=""/>
            <!-- 存储上次单击的环节名称-->
            <input type="hidden" autocomplete="off" name="tacheInput" value=""/>
            <!-- 存储上次单击的环节ID-->
            <input type="hidden" autocomplete="off" name="ta_id" value=""/>
            <!-- 课程ID -->
            <input type="hidden" autocomplete="off" name="co_id" value="{$course.co_id}">
            <!-- 课文名称，异步加载课文 -->
            <input type="hidden" autocomplete="off" name="l_title" value="">
            <!-- 课时名称，异步加载课时-->
            <input type="hidden" autocomplete="off" name="cl_title" value="">
            <!-- 当前课文ID，为环节、活动准备-->
            <input type="hidden" autocomplete="off" name="l_id" value="">
            <!-- 当前课时ID，为环节、活动准备-->
            <input type="hidden" autocomplete="off" name="cl_id" value="">
            <!--存储课时总资源页数-->
            <input type="hidden" autocomplete="off" name="pages" value="0"/>
            <!-- 左侧树形结构开始 -->
            <div class="lesson_left fl">
                <ul class="tree fl tree_drag" id="">
                    <li attr=""></li>
                </ul>
            </div>
            <!-- 左侧树形结构结束 -->
            <!-- 中部开始 -->
            <div class="lesson_main fl">
                <div class="main_top">
                    <p class="courseTitle">{$title}</p>
                </div>
                <div class="main_top second">
                    <p class="title"></p>
                    <p class="order_switch">
                        <a href="javascript:void(0)" class="list"></a>
                        <a href="javascript:void(0)" class="thumb on"></a>
                    </p>
                </div>
                <div class="tache_box fl">
                    <div class="tacheList">
                    </div>
                    <div class="add_tache">
                    </div>
                </div>
            </div>
            <!-- 中部结束 -->
            <!-- 右侧开始 -->
            <div class="lesson_right fl">
                <!-- <p class="title">最新资源</p> -->
                <ul class="res_tab">
                    <li class="on">课时资源</li>
                    <!-- <li>推荐资源</li> -->
                </ul>
                <div class="resBox">
                    <span class="arrowPage pageUp"></span>
                    <span class="arrowPage pageDown"></span>
                    <div class="scrollArea">
                        <div class="res_box">
                            <ul class="res_box_ul"></ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 右侧结束 -->
        </div>
    </div>
    <div class="clear"></div>
    <div class="foot_bot"></div>
    <div class="foot_top"></div>
    <div id="footer">
        <div class="nav back1"></div>
        Copyright &copy; 2007-2011 北京金商祺移动互联 All Rights Reserved.
    </div>
</body>
</html>